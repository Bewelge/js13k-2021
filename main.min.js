!function(){var t=!0,e=Math.PI/2,n=2*Math.PI,i=Math.random,h=Math.floor,r=t=>document.body.removeChild(t),a=(t,e)=>t.appendChild(e),o=(t,e,n)=>t.addEventListener(e,n),l=(t,e)=>t.hasOwnProperty(e);var s,u,f,c,M,d=new class{constructor(){this.t={}}i(t,e,n,i,h){this.t[t]={h:e,o:n,l:i,max:h,list:[]}}o(t){t.map((t=>this.t[t])).forEach((t=>{t.h();for(let e=t.list.length-1;e>=0;e--)--t.list[e][0]>0?t.o(t.list[e]):t.list.splice(e,1);t.l()}))}add(t,e){this.t[t].list.push(e),this.t[t].list.length>this.t[t].max&&this.t[t].list.splice(0,1)}},w=window.innerWidth,p=window.innerHeight,m={x:0,y:0};let g=h(99999*i());console.log("Ship seed: "+g);var b,x,y=25,v=3500,S={x:0,y:0},D=0,P={},k=!1,W={},C=new Set,H=6e3,R=.01,A=!1,O=window.performance.now(),j=0,T={},z={},Y=0,I={},L={};let N={};var V,q,K=[],E={},F={},B=0;function G(){g=h(99999*i());let t=Be(g),n={x:h(1e4*t()),y:h(1e4*t())};for(;!dt(n)||!wt(n.x,n.y).u.length;)n={x:h(1e4*t()),y:h(1e4*t())};m=gt(wt(n.x,n.y).u[0],D),z.level=0,(z=mt(t,g)).x=m.x+25,z.y=m.y+25,z.level=1,z.M=-e,z.p=we(0,0),z.m=we(0,0),z.g=Te(g,z.level/500)}class U{constructor(t){this.seed=t.seed,this.g=Te(t.seed,z.level/500),this.race=t.race,this.v=t.v,this.S=t.S,this.speed=t.speed,this.D=t.D,this.P=0,this.k=t.k/this.g.C.W,this.H=t.H,this.R=t.R,this.A=t.A||.02,this.O=t.O,this.size=t.size;let e=this.j();this.x=e.x,this.y=e.y,this.p={x:0,y:0},this.T=0,this.M=i()*n}Y(){Z(this)}update(){let t=kt(this,z);this.P>0&&(this.P-=1*(this.g.C.I?.5:1)),t<this.R?(t<this.v&&(!this.g.C.I&&this.P<=0&&(this.Y(),this.P=this.H),this.L=this.N=!1),this.V=z,b||(b=this),this.moveTo(z)):(this.V==z&&t>this.R*(Ot(nt(this),nt(z))?5:2.5)&&(this.V=null),(!this.V||kt(this.V,this)<5)&&(this.V=this.j()),this.V.x==this.x&&this.V.y==this.y&&this.V.x++,this.moveTo(this.V)),ye(this.p,.99),xe(this,this.p),ft(this,!1),[this.g.q,this.g.m,this.g.K,this.g.C].forEach((t=>{t.F<=0&&!t.I&&(t.I=!0,t!=this.g.C&&(ct(this,t),J(this,.4)))})),this.g.q.I&&(this.I=!0,J(this),z.level+=1)}j(){if(this.O.u){let t=gt(this.O.u[h(i()*this.O.u.length)],D);return ve(t,Me(0,n),Me(0,40)),t}return we(this.O.B.x+Me(-1,1)*this.O.size,this.O.B.y+Me(-1,1)*this.O.size)}o(){let t=bt(this.x,this.y),e=this.size*y*7,n=b==this;if((kt(S,t)<1*e||n)&&null==x){n||(x=this),me(c,"green"),c.textBaseline="top",De(c,14);let i=t.y-60-e/2,h=this.race+" Ship";Zt(c,h,t.x-$t(c,h)/2,i-16),De(c,10),rn().forEach(((e,n)=>{let h=i+13*n;Zt(c,an[e].name,t.x+33,h),Xt(c,t.x-30,h,60*this.g[e].F/this.g[e].G,5)}))}if(c.lineWidth=n?3:1,ge(c,"rgba(200,50,50,0.2)"),Qt(c,t.x-e/2,t.y-e/2,e,e),function(t,e){return t.x>-e&&t.x<w+e&&t.y>-e&&t.y<p+e}(t,y))lt(this,this.U,this.N,this.L,!0);else{let e=jt(t.x,0,w),n=jt(t.y,0,p);me(c,"rgba(200,50,50,0.7)"),c.lineWidth=3,Gt(c),Xe(c,e,n,18,Ht(t.x,t.y,e,n)),Ut(c),re(c)}}moveTo(t){let e=Ct(t,this);if(Rt(e,this.M)<2*this.S)this.M=e;else{let t=.05*-this.S*At(e,this.M+Math.PI,this.S);t>0?this.N=!0:t<0&&(this.L=!0),this.T+=t*(this.g.K.I?.1:1)}this.M+=this.T,this.T*=.9+(this.g.K.I?.09:0);let n=kt(this,t),i=Math.min(1,n/this.v)*this.speed*(this.g.m.I?.1:1);ve(this.p,this.M,i),this.U=!0}}function J(t,e=1){for(let n=0;n<25;n++){let h=.05*y;Mn.J(mn.X,e),window.setTimeout((()=>{d.add(1,[36,Me(-h,h),Me(-h,h),t,i()<.5?[255,Me(50,255),Me(50,100)]:vt(t.seed),Me(1,3)*e])}),15*n)}}function Q(){w=window.innerWidth,p=window.innerHeight,s.width=w,s.height=p,u.width=w,u.height=p,f.width=w,f.height=p,Ge(w,p)}function X(){if(!t){let n=window.performance.now();for(j+=n-O,O=n;j>16;)j-=16;D+=1,function(){!function(){V=nt(z),q=Object.values(z.g).forEach((e=>{if(!e.I&&e.F<=0&&(e.I=!0,e==z.g.q))return Object.values(z.g).filter((t=>t!=z.g.C)).forEach((t=>ct(z,t))),z.I=!0,J(z),void window.setTimeout((()=>{t=!0,function(){let e=oe(),n=ue("Continue anyway",(()=>{!function(){Object.values(z.g).forEach((t=>{t.F=t.G,t.I=!1})),z.I=!1;let e=nt(z);if(dt(e)){let t=wt(e.x,e.y);be(z,t.B.x-t.size,t.B.y-t.size)}else be(z,e.x*v,e.y*v);ye(z.p,0),t=!1}(),r(e)})),i=ue("Start another game",(()=>{I={},L={},E={},b=null,G(),r(e),t=!1}));de(e,[le("Oh no. You died."),n,i]),window.setTimeout((()=>e.style.height="100%"),50)}()}),2500)}));let n=z.g;dt(V)?(function(t){t.u.forEach((t=>{let e=gt(t,D),n=gt(t,D+1),i=kt(z,e);if(i<10*t.rad){let h=Ct(z,e);z.p.x+=(.1*Math.cos(h)*t.rad+.5*(n.x-e.x))/Math.max(t.rad,i)**2,z.p.y+=(.1*Math.sin(h)*t.rad+.5*(n.y-e.y))/Math.max(t.rad,i)**2}}));let e=Ct(z,t.B),n=kt(t.B,z);z.p.x+=.1*Math.cos(e)*t.Z/Math.max(t.Z,n)**2,z.p.y+=.1*Math.sin(e)*t.Z/Math.max(t.Z,n)**2}(q=wt(V.x,V.y)),z.$=!1,z._=!1,q.u.forEach((t=>{kt(z,gt(t,D))<t.rad&&Object.values(n).forEach((t=>{z.$=!0,t.F=Math.min(t.G,t.F+t.G/1e3),t.F==t.G?t.I=!1:z._=!0}))}))):q=null;let i=z.speed*(n.m.I?.25:1),h=z.S*(n.K.I?.5:1);(P[it]||P[ht])&&ve(z.m,z.M,i);(P[rt]||P.tt)&&ve(z.m,z.M,-i);let a=-At(Ht(w/2,p/2,S.x,S.y),z.M,h*(n.K.I?.1:1));z.N=Math.max(0,a<0?10:z.N-1),z.L=Math.max(0,a>0?10:z.L-1),Rt(Ht(w/2,p/2,S.x,S.y),z.M)<h?z.M=Ht(w/2,p/2,S.x,S.y):z.M+=a*h;(P.et||P[at])&&ve(z.m,z.M+e,-i);(P.nt||P[ot])&&ve(z.m,z.M+e,i);if(xe(z.p,z.m),Dt()>299792){let t=Dt()/299792;ye(z.p,1/t)}xe(z,z.p),ye(z.m,0),ft(z,!0)}();for(let t=0;t<1;t++)_();z.P>0&&(z.P-=1*(z.g.C.I?.5:1));k&&!z.I&&z.P<=0&&(z.P=z.H,Mn.J(mn.Y),Z(z));for(let t=V.x-1;t<=V.x+1;t++)for(let e=V.y-1;e<=V.y+1;e++)q&&kt(q.B,z)<v&&pt(t,e).forEach((t=>{(kt(t,z)<1e3||et(t,z))&&C.add(t)}));C.forEach((t=>t.update())),C.forEach((t=>{kt(t,z)>1e3&&t.V!=z&&!et(t,z)&&Ot(nt(t),t.O)&&C.delete(t)})),C.forEach((e=>{if(e.I){let n=pt(e.O.x,e.O.y);n.splice(n.indexOf(e),1),C.delete(e),0==n.length&&window.setTimeout((()=>{t=!0,en(z,e,(function(){z.level+=3,ut=0,O=window.performance.now(),t=!1}))}),500)}}))}(),function(){if(qt(c,0,0,w,p),b&&!b.I){let t=bt(b.x,b.y),e=Wt(w/2,p/2,t.x,t.y),n=Math.min(w,p-300)/2;e>1.5*n&&y>1.5?y=Math.min(H,Math.max(R,Math.max(y-.02,.99*y))):e<.5*n&&(y=Math.min(H,Math.max(R,Math.min(y+.02,1.01*y))))}let t={it:h((m.x-w/2/y)/v),ht:h((m.x+w/2/y)/v),rt:h((m.y-p/2/y)/v),at:h((m.y+p/2/y)/v)};null,null,m={x:z.x,y:z.y};for(let e=t.it;e<=t.ht;e++)for(let n=t.rt;n<=t.at;n++)tt(e,n);d.o([4,3]),x=null,C.forEach((t=>t.o())),c.lineWidth=.5,Object.entries(W).forEach((t=>{let e=t[0],n=t[1];Lt(c,n.map((t=>[xt(t[0]),yt(t[1]),Math.max(1.5,.1*y)*(t[5]<50?t[5]/50:1)])),n.length?Oe(vt(e)):"black","black")})),function(){let t=z.x,n=z.y;++Y>10&&(Y=0,K.push([t,n]),K.length>500&&K.splice(0,1));if(z.I)return;if(y<5){let e=bt(t,n);if(c.lineWidth=1,Vt(c,e,Se(e,z.M,30),"rgb(50,50,50,0.4)"),Gt(c),ge(c,"rgba(255,255,255,0.3)"),K.length){let t=bt(K[0][0],K[0][1]);Et(c,t.x,t.y),K.forEach((e=>{t=bt(e[0],e[1]),Kt(c,t.x,t.y)})),Kt(c,e.x,e.y),Jt(c),Ut(c)}}let h=P[ht]||P[it];h&&z.g.m.points.filter((t=>i()<.6)).forEach((t=>{let n=t[0]+z.g.m.ot*i(),h=ve(Se(z,z.M-e,-n),z.M,-t[1]-z.g.m.lt);d.add(3,[Me(5,50),h.x,h.y,z.M+Me(-.1,.1),Me(40,60)])}));lt(z,h,z.N,z.L,!1),y>5e3&&(De(c,p/2*y/5e3*z.size),c.textBaseline="top",me(c,"black"),Zt(c,"üë®‚ÄçüöÄ",w/2-$t(c,"üë®‚ÄçüöÄ")/2,p/2),c.font="12px Arial")}(),d.o([0,1,2]),St()}()}window.requestAnimationFrame(X)}function Z(t){let n=t.g.C;for(let i=0;i<n.W;i++){let h=n.x+ +i*(n.w+n.margin),r=Tt(t.size*h,t.size*n.top),a=xe(ve(we(0,0),t.M,t.A),t.p),o=Tt(a.x,a.y).st;$(t.seed,t.x+Math.cos(t.M+e+r.angle)*r.st,t.y+Math.sin(t.M+e+r.angle)*r.st,t.M,o,t.k,t.D,n.ut),r=Tt(t.size*-h,t.size*n.top),$(t.seed,t.x+Math.cos(t.M+e+r.angle)*r.st,t.y+Math.sin(t.M+e+r.angle)*r.st,t.M,o,t.k,t.D,n.ut)}}function $(t,e,n,i,h,r,a,o){l(W,t)||(W[t]=[]),W[t].push([e,n,i,h,r,a,o])}function _(){Object.values(W).forEach((t=>{for(let e=t.length-1;e>=0;e--){let n=t[e];n[0]+=Math.cos(n[2])*n[3],n[1]+=Math.sin(n[2])*n[3],(--n[5]<=0||n[0]<m.x-3*w/y||n[1]<m.y-3*p/y||n[0]>m.x+3*w/y||n[1]>m.y+3*p/y)&&t.splice(e,1)}}))}function tt(t,e){if(c.lineWidth=.1,dt({x:t,y:e})){let h=wt(t,e),r=Be(h.seed),a=bt(h.B.x,h.B.y),o=kt(a,S)<h.size*y;if(o&&h,y<.5&&o){ge(c,"green"),me(c,"green"),c.lineWidth=.5;let t=h.name;De(c,16);var i=h.size*y*2;Qt(c,a.x-i/2,a.y-i/2,i,i),Zt(c,t,a.x-$t(c,t)/2,a.y-i/2-18)}let l=h.Z*y,s=a.x,u=a.y;Yt(c,s,u,l-10*y,h.ft(y,1));for(let t=0;t<Math.min(60,Math.max(5,30*Math.log(y)));t++)me(c,Oe([255,Me(100+1/y,255,r),Me(50+1/y,255,r),r],.09/jt(y,.1,5))),Gt(c),c.ellipse(s,u,l*(.8+.4*r()*Math.abs(r()*t*.01%1-.5)),l*(.8+.4*r()*Math.abs((r()*t*.01+.5)%2-1)),r()*n+Math.abs((r()*t*.01+.5)%2-1),0,n,0),re(c),Ut(c);!function(t){ge(c,"white"),c.lineWidth=.1,t.u.filter((t=>t.rad*y>1)).forEach((t=>function(t){let e=gt(t,D),n=bt(e.x,e.y);kt(n,S)<t.rad*y&&t;let i=t.ct+D*t.Mt;te(c),Yt(c,n.x,n.y,t.rad*y,t.ft),_t(c),Gt(c);let h="rgba(255,255,255,0.5)",r=Se(n,i,-t.rad*y*1.7);y>.05&&(h=c.createRadialGradient(r.x,r.y,0,r.x,r.y,t.rad*y*3),h.addColorStop(0,Oe([255,255,255],.5)),h.addColorStop(1,Oe([0,0,0],0)));Yt(c,r.x,r.y,t.rad*y*2,h);let a=(n,h)=>{let r=bt(n.x,n.y),a=kt(n,e);if(a<5*t.rad){let e=Se(r,i,Math.sqrt(a*y*150+150));me(c,t.ft),Pe(c,e.x,e.y,.95*y,n.g,n.M,{fill:t.ft,dt:h})}};a(z,!1),C.forEach((t=>a(t,!0))),ee(c)}(t)))}(h)}}function et(t,e){return Ot(nt(t),nt(e))}function nt(t){return{x:h(t.x/v),y:h(t.y/v)}}window.onload=()=>{s=document.getElementById("c"),u=document.getElementById("b"),f=document.getElementById("h"),c=s.getContext("2d"),M=f.getContext("2d");let t=null;o(window,"resize",(()=>{clearTimeout(t),t=window.setTimeout(Q)})),Q(),o(window,"keydown",(t=>{P[t.code]=!0,"KeyM"==t.code&&(wn=!wn),"KeyK"==t.code&&C.forEach((t=>Object.values(t.g).forEach((t=>t.F=0))))})),o(window,"keyup",(t=>P[t.code]=!1)),o(window,"mousedown",(t=>{k=!0,S={x:t.clientX,y:t.clientY},x&&(b=x)})),o(window,"mouseup",(t=>{k=!1,A=!1}));let n=document.getElementById("zoomHandle"),h=document.getElementById("zoomBar"),a=()=>{n.style.top=h.clientHeight-jt(y/(Math.log10(H)-Math.log10(R))*h.clientHeight,0,h.clientHeight)+"px"};a(),o(n,"mousedown",(t=>{t.preventDefault(),A=t.clientY-n.getBoundingClientRect().top}));let l=t=>{let e=h.getBoundingClientRect(),i=Math.max(.1,Math.min(h.clientHeight,t.clientY-e.top-A));return n.style.top=Math.min(h.clientHeight,Math.max(0,i))+"px",jt(Math.max(.1,h.clientHeight-i)/h.clientHeight*(Math.log10(H)-Math.log10(R)),R,H)};o(h,"mousedown",(t=>{A=0,y=l(t),A=!0})),o(window,"mousemove",(t=>{A&&(y=l(t)),k&&(m.x+=(S.x-t.clientX)/y,m.y+=(S.y-t.clientY)/y),S.x=t.clientX,S.y=t.clientY}));let w=!1;o(window,"wheel",(t=>{if(w)return;w=!0,b=null;let e=t.wheelDelta?t.wheelDelta:-1*t.deltaY,n=(e+1)/(Math.abs(e)+1)*Math.min(Math.abs(e));var i=n/Math.abs(n);y=Math.min(H,Math.max(R,y*(i<0?.95:1.05))),w=!1,a()})),function(){d.i(3,(()=>me(c,"rgba(255,255,255,0.3)")),(t=>{let e=(60-t[4])/3e3;t[1]-=Math.cos(t[3])*e,t[2]-=Math.sin(t[3])*e,t[4]*=.999;let n=bt(t[1],t[2]),h=.3*t[4]/150*(.2+.8*i())*y;Lt(c,Array.apply(null,Array(Math.ceil(5*i()))).map((t=>[n.x+Me(-h,h),n.y+Me(-h,h),h])),"rgba(255,255,255,0.3)")}),(()=>{}),250);let t=(t,n,i)=>{let h=Tt(t[1],t[2]),r=Se(we(0,0),h.angle+e+t[3].M,h.st);Je(i,c,bt(t[3].x+r.x,t[3].y+r.y),n,t[4])};d.i(0,(()=>{}),(e=>t(e,jt(2*y,6,15),e[0]/10)),(()=>{}),250),d.i(1,(()=>{}),(e=>t(e,e[3].size*e[5]*y,Math.abs(e[0]-18)/18)),(()=>{}),250),d.i(2,(()=>{}),(t=>{let e=bt(t[1],t[2]),n=Me(.1*y,.2*y);Lt(c,Array.apply(null,Array(Math.ceil(15*i()))).map((t=>[e.x+Me(-n/3,n/3),e.y+Me(-n/3,n/3),n])),"rgba(255,255,255,0.3)")}),(()=>{}),250),d.i(4,(()=>{}),(t=>{let n=t[1],i=t[2],h=bt(n.x,n.y);zt(c,h.x,h.y,(()=>{ce(c,y*t[4],t[3]+e),me(c,Oe(t[5].color)),c.fill(t[5].path)})),xe(n,i),t[3]+=.04,t[4]*=.99}),(()=>{}),250)}(),function(){let t=oe();de(t,[ae(""),le("Space"),,se(["Mouse to aim.","WASD or Arrow keys to thrust.","Click to shoot.","Scroll to zoom.","","","","Defeat Enemies to improve ship","Hover over planets to repair"].join("</br>")),ue("Start game",(()=>{G(),r(t),st(),Mn=new pn})),ue("Start muted",(()=>{Mn=new pn,G(),r(t),wn=!0,st()})),ae("")]),t.style.height="100%"}(),X()};var it="KeyW",ht="ArrowUp",rt="ArrowDown",at="ArrowLeft",ot="ArrowRight";function lt(t,n,i,r,a){let o=h(t.x/v),l=h(t.y/v),s=wt(o,l),u=dt({x:o,y:l}),f=u?s.size-kt(t,s.B):0;t.size=1;let M=u?f/s.size*.25:0,d=bt(t.x,t.y);Pe(c,d.x,d.y,1*y,t.g,t.M,{wt:u?Ct(s.B,t):-1-t.M-e,st:M,dt:a,U:n,N:i,L:r})}function st(){G();let n=oe(),i=fe(300,300),h=!1,a=i.getContext("2d"),o=()=>{qt(a,0,0,300,300),zt(a,150,150,(()=>{te(a),ie(a,40,40),Pe(a,0,0,1,z.g,-e,{wt:Ht(S.x,S.y,w/2,i.getBoundingClientRect().top+150),st:.2,U:!0,N:!0,L:!0}),ee(a),h||window.requestAnimationFrame(o)}))};o();let l=se(z.race);de(n,[ae(""),le("Choose a race"),l,i,ue("New Race",(()=>{G(),l.innerHTML=z.race})),ae(""),ae(""),ue("Confirm",(()=>{h=!0,r(n),t=!1})),ae(""),ae(""),ae("")]),n.style.height="100%"}var ut=0;function ft(t,n){Object.entries(W).filter((e=>e[0]!=t.seed)).forEach((i=>{let h=i[0],r=i[1];for(let i=r.length-1;i>=0;i--){let u=r[i],f=(a=u[0],o=u[1],l=t.x,s=t.y,{angle:Ht(a,o,l,s),st:Wt(a,o,l,s)}),M=Math.cos(f.angle-t.M+e)*f.st,w=Math.sin(f.angle-t.M+e)*f.st;Object.keys(an).forEach((e=>{let a=t.g[e];if((!a.I||n)&&c.isPointInPath(a.gt?a.gt:a.path,M,w))return r.splice(i,1),ut++<50&&(Et(a.bt,M,w),Bt(a.bt,M,w,Me(.02,.1))),a.F=Math.max(0,a.F-u[4]),a.xt=15,Mn.J(mn.yt),d.add(0,[Me(15,25),M,w,t,vt(h)]),void d.add(2,[Me(5,30),u[0]+Me(-1,1),u[1]+Me(-1,1)])}))}var a,o,l,s}))}function ct(t,n){d.add(4,[250,pe(t),pe(t.p),t.M+e,t.size,n])}function Mt(t){return Oe([Math.min(255,h(75*t())),Math.min(255,h(75*t())),Math.min(255,h(75*t()))],1)}function dt(t){return l(I,t.x)||(I[t.x]={}),l(I[t.x],t.y)||(I[t.x][t.y]=Be(""+Math.abs(10*t.x+345)*Math.abs(3*t.y+213)%1234)()>.9),I[t.x][t.y]}function wt(t,e){if(!dt({x:t,y:e}))return{};if(l(L,t)||(L[t]={}),!l(L[t],e)){let i=t>e?-2*t-1:2*t,r=t>e?-2*e-1:2*e,a=(i+r)*(i+r+1)*.5+r,o=Be(a);l(N,a)||(N[a]=[t,e]);let s=60+60*o(),u=(.1*Math.sign(o()-o())+.2*(o()-o()))*v,f=(.1*Math.sign(o()-o())+.2*(o()-o()))*v,M={x:t*v+1750+u,y:e*v+1750+f},d=.95*(1750-Math.max(Math.abs(u),Math.abs(f)))-20,w=2+h(9*o()),p=[],m=2*s;for(let i=0;i<w&&m<d;i++){let h=15+15*o(),r=Math.max(2*h+h*o(),(d-m-2*h)/(w-i)*o()),a={rad:h,vt:m+r,Mt:.0012*o()+5e-4,St:.002*o()+.001,ct:o()*n,Dt:M,ft:Mt(o),Pt:[t,e],index:i};m+=r+h,p.push(a)}let g=o(),b=o(),x=(t,e)=>function(t,e,n,i){let r=Math.min(255,5*-t+10+h(200*n)),a=Math.min(255,5*-t+10+h(200*i));me(c,Oe([Math.max(r,Math.min(50*t,255)),r,a],e))}(s*t,1,g,b),y=tn(o);L[t][e]={B:M,u:p,Z:s,size:m,ft:x,name:y,seed:a,x:t,y:e}}return L[t][e]}function pt(t,e){if(T[t]&&T[t][e]||!dt({x:t,y:e}))return[];if(l(E,t)||(E[t]={}),!l(E[t],e)){E[t][e]=[];let n=wt(t,e),i=n.seed,h=Be(i),r=Math.ceil(3+12*h()*z.level/500),a=mt(h,i);a.O=n;for(let n=0;n<r;n++)E[t][e].push(new U(a))}return E[t][e]}function mt(t,e){let n=[.5,.6,.6,1,1,1.1,1.1,1.2].sort(((e,n)=>Me(-1,1,t))),i=()=>n.shift()+Me(-.1,.1,t),h=Math.min(500,z.level)/500;var r=Me(9,9+500*h,i),a=.1+1.9*h*i();let o=.003+.017*z.level/500*i();return{seed:e,v:r,S:.05+.04*h*i(),speed:o,R:Math.max(75,r*(1+i())),k:Math.ceil(1+800*h*i()),H:Math.min(30,30-Math.min(1,28*Math.ceil(Math.log(1+500*h)/Math.log(501))*i())),A:a,size:1+i(),D:r/a,P:0,race:_e(t)}}function gt(t,e){let n=t.ct+e*t.Mt;return{x:t.Dt.x+Math.cos(n)*t.vt,y:t.Dt.y+Math.sin(n)*t.vt}}function bt(t,e){return{x:xt(t),y:yt(e)}}function xt(t){return w/2-m.x*y+t*y}function yt(t){return p/2-m.y*y+t*y}function vt(t){if(!l(F,t)){let e=Be(t);F[t]=[h(155+100*e()),h(155+100*e()),h(155+100*e())]}return F[t]}var St=()=>{M.font="24px Arial",qt(M,0,0,w,p),function(){me(M,"green");let t=Dt();De(M,17);let e="Current Speed: "+t+"km/s",n=$t(M,e);Zt(M,e,w/2-n/2,280);let i=Math.min(45,50*Wt(0,0,z.p.x,z.p.y)),h=Ht(0,0,z.p.x,z.p.y);M.lineWidth=2,Yt(M,w/2,175,90,"black"),It(M,w/2,175,90,"green"),M.lineWidth=2,Gt(M),Et(M,w/2,175),Kt(M,w/2+Math.cos(h)*i,175+Math.sin(h)*i),Xe(M,w/2+Math.cos(h)*(i+7.5),175+Math.sin(h)*(i+7.5),10,h),Ut(M),Jt(M),ee(M)}(),q&&q.u?function(){B++;let t=w-330,e=25;te(M),me(M,"black"),Gt(M),ne(M,t,e,300,300),_t(M),re(M),Ut(M),me(M,"green"),Qt(M,t,e,300,300),M.lineWidth=.4,Gt(M);for(let n=0;n<6;n++)Et(M,t,e+300*n/6),Kt(M,t+300,e+300*n/6),Et(M,t+300*n/6,e),Kt(M,t+300*n/6,e+300);Jt(M),Ut(M);let n=1.2*q.size/150,i=e=>t+150+(e-q.B.x)/n,h=t=>e+150+(t-q.B.y)/n;Yt(M,t+150,e+150,q.Z/n,"green"),q.u.forEach((t=>{let e=gt(t,D);Yt(M,i(e.x),h(e.y),Math.max(3,t.rad/n),"green")})),Ut(M),re(M);let r=(n,r,a)=>{Yt(M,Math.max(t,Math.min(t+300,i(n.x))),Math.max(e,Math.min(e+300,h(n.y))),r,a)},a=pt(q.x,q.y);a.forEach((t=>{r(t,2+3*Math.abs(Math.abs(B-100)%200-100)/100,"red")})),r(z,2+3*Math.abs(B%200-100)/100,"yellow");let o=i(z.x),l=h(z.y);if(ge(M,"yellow"),M.globalAlpha=.5,M.lineWidth=.5,Gt(M),K.length){let t=i(K[0][0]),e=h(K[0][1]);Et(M,t,e),K.forEach((n=>{t=i(n[0]),e=h(n[1]),Kt(M,t,e)})),Kt(M,o,l),Jt(M),Ut(M)}M.globalAlpha=1;let s=q.name||" ",u=$t(M,s);me(M,"green"),Zt(M,s,w-175-u/2,30),s="Hostile Ships: "+a.length,u=$t(M,s),a&&Zt(M,s,w-175-u/2,300);ee(M)}():function(){B++;let t=w-330,e=25;me(M,"black"),Xt(M,t,e,300,300),me(M,"green"),Qt(M,t,e,300,300),te(M),ne(M,t,e,300,300),_t(M),M.lineWidth=.2,Gt(M);for(let n=0;n<8;n++)Et(M,t,h(e+300*n/8)),Kt(M,t+300,h(e+300*n/8)),Et(M,h(t+300*n/8),e),Kt(M,h(t+300*n/8),e+300);Jt(M),Ut(M);let n=4,i=nt(z),r=v*n*2/300,a=e=>t+150+(e-z.x)/r,o=t=>e+150+(t-z.y)/r;for(let t=i.x-n;t<i.x+n;t++)for(let e=i.y-n;e<i.y+n;e++)if(dt({x:t,y:e})){let i=wt(t,e);Yt(M,a(i.B.x),o(i.B.y),i.Z/(v*n/300),"green")}De(M,12);for(let e=i.x-n;e<i.x+n;e++)for(let h=i.y-n;h<i.y+n;h++)if(dt({x:e,y:h})){let n=wt(e,h),i=n.name,r=$t(M,t);Zt(M,i,a(n.B.x)-r/2,o(n.B.y)+5)}Yt(M,t+150,e+150,2+3*Math.abs(B%200-100)/100,"yellow"),ee(M)}(),ge(M,"green"),me(M,"black"),Qt(M,25,25,400,300),Xt(M,25,25,400,300),zt(M,150,175,(()=>{M.lineWidth=.03,Pe(M,0,0,40,z.g,z.M,{fill:"black",stroke:"green"})})),function(){let t=50,e=275;ge(M,"green"),M.lineWidth=1,M.textBaseline="top",De(M,18),M.fontWeight=800;let n="";rn().forEach((i=>{me(M,"green"),Zt(M,an[i].name,e,t),Qt(M,e,t+20,100,10),me(M,Pt(z.g[i])),Xt(M,e,t+21,100*z.g[i].F/z.g[i].G,8),t+=55,z.g[i].F<=0&&(n=""==n?an[i].name+" critically damaged. Return to planet to repair.":"Ship critically damaged. Return to planet to repair.")})),""!=n&&(me(M,"red"),Zt(M,n,37,290));me(M,Pt(z.g.q)),Qt(M,50,35,200,12),Xt(M,50,35,200*z.g.q.F/z.g.q.G,12),me(M,"rgba(200,200,50,"+(.5-.5*z.P/z.H+.5)+")"),Qt(M,e,t-135,100,4),Xt(M,e,t-135,100-100*z.P/z.H,4)}()};function Dt(){return h(1e3*Wt(0,0,z.p.x,z.p.y))/10}function Pt(t){return t.I?"grey":t.xt?(t.xt--,"red"):Oe([128-128*t.F/t.G,0+128*t.F/t.G,0],1)}function kt(t,e){try{return Wt(t.x,t.y,e.x,e.y)}catch(t){}}function Wt(t,e,n,i){return Math.sqrt(Math.pow(n-t,2)+Math.pow(i-e,2))}function Ct(t,e){return Ht(t.x,t.y,e.x,e.y)}function Ht(t,e,n,i){return Math.atan2(i-e,n-t)}function Rt(t,e){return Math.abs((t+n)%n-(e+n)%n)}function At(t,e,i){return(t%=n)<0&&(t+=n),(e%=n)<0&&(e+=n),Math.abs(e-t)>i?function(t,e){let i=t-e;i<0&&(i+=n);return i>Math.PI?1:-1}(t,e)>0?1:-1:0}function Ot(t,e){return t.x==e.x&&t.y==e.y}function jt(t,e,n){return Math.min(n,Math.max(e,t))}function Tt(t,e){return{angle:Ht(0,0,t,e),st:Wt(0,0,t,e)}}function zt(t,e,n,i){te(t),he(t,e,n),i(),ee(t)}var Yt=(t,e,n,i,h)=>{Nt(t,e,n,i),me(t,h),re(t)},It=(t,e,n,i,h)=>{Nt(t,e,n,i),ge(t,h),Jt(t)},Lt=(t,e,n,i)=>{Gt(t),e.forEach((e=>{Et(t,e[0],e[1]),Bt(t,e[0],e[1],e[2])})),Ut(t),i&&(ge(t,i),Jt(t)),n&&(me(t,n),re(t))},Nt=(t,e,n,i)=>{Gt(t),Bt(t,e,n,i,0,8),Ut(t)},Vt=(t,e,n,i)=>{i&&ge(t,i),Gt(t),Et(t,e.x,e.y),Kt(t,n.x,n.y),Jt(t),Ut(t)},qt=(t,e,n,i,h)=>t.clearRect(e,n,i,h),Kt=(t,e,n)=>t.lineTo(e,n),Et=(t,e,n)=>t.moveTo(e,n),Ft=(t,e,n,i,h)=>t.quadraticCurveTo(e,n,i,h),Bt=(t,e,i,h)=>t.arc(e,i,h,0,n),Gt=t=>t.beginPath(),Ut=t=>t.closePath(),Jt=t=>t.stroke(),Qt=(t,e,n,i,h)=>t.strokeRect(e,n,i,h),Xt=(t,e,n,i,h)=>t.fillRect(e,n,i,h),Zt=(t,e,n,i)=>t.fillText(e,n,i),$t=(t,e)=>t.measureText(e).width,_t=t=>t.clip(),te=t=>t.save(),ee=t=>t.restore(),ne=(t,e,n,i,h)=>t.rect(e,n,i,h),ie=(t,e)=>t.scale(e,e),he=(t,e,n)=>t.translate(e,n),re=t=>t.fill(),ae=t=>{let e=document.createElement("div");return e.className=t,e},oe=()=>{let t=ae("dialog");return a(document.body,t),t},le=t=>{let e=ae("title");return e.innerHTML=t,e},se=t=>{let e=ae("subTitle");return e.innerHTML=t,e},ue=(t,e)=>{let n=document.createElement("button");return n.onclick=e,n.innerHTML=t,n},fe=(t,e)=>{let n=document.createElement("canvas");return n.width=t,n.height=e,n},ce=(t,e,n)=>{t.scale(e,e),t.rotate(n)},Me=(t=0,e=1,n=i)=>t+(e-t)*n(),de=(t,e)=>{e.forEach((e=>a(t,e)))},we=(t,e)=>({x:t,y:e}),pe=t=>({x:t.x,y:t.y}),me=(t,e)=>{t.fillStyle=e},ge=(t,e)=>{t.strokeStyle=e},be=(t,e,n)=>{t.x=e,t.y=n},xe=(t,e)=>(t.x+=e.x,t.y+=e.y,t),ye=(t,e)=>(t.x*=e,t.y*=e,t),ve=(t,e,n)=>(t.x+=Math.cos(e)*n,t.y+=Math.sin(e)*n,t),Se=(t,e,n)=>({x:t.x+Math.cos(e)*n,y:t.y+Math.sin(e)*n}),De=(t,e)=>{t.font=e+"px Gill Sans MT"},Pe=(t,n,i,h,r,a,o)=>{zt(t,n,i,(()=>{ce(t,h,a+e),r.C.I&&o.dt||Re(t,r,o),r.K.I&&o.dt||He(r,t,o),r.q.I&&o.dt||Ce(r,t,o),r.m.I&&o.dt||We(r,t,o)}))};function ke(t,e,n,i){n.forEach((n=>{i.fill&&(me(t,i.fill),t.fill(n)),i.stroke&&(ge(t,i.stroke),t.stroke(n)),i.stroke||i.fill||Ae(t,n,Oe(n.color||e.color),je(n.color||e.color,15),i.wt,i.st)}))}var We=(t,e,n)=>{ke(e,t.m,[t.m.path,t.m.kt],n);let i=t.m,h=i.Wt/(i.W+1);for(let t=1;t<=i.W;t++)if(n.U){let n=i.top+i.Ct+i.lt;var r=-i.Wt/2+t*h-i.ot/2;me(e,"rgba(255,55,55,0.8)"),Xt(e,r,n,i.ot,Me(.1,.25)),me(e,"rgba(255,255,55,0.8)"),Xt(e,r,n,i.ot,Me(.1,.25))}},Ce=(t,e,n)=>{if(ke(e,t.q,[t.q.path],n),!n.fill&&!n.stroke){te(e),e.clip(t.q.bt),me(e,n.fill||"rgba(0,0,0,0.7)"),e.fill(t.q.path),ee(e);let i=t.q.Ht/2*t.q.Rt,h=e.createLinearGradient(-i,0,i,0);h.addColorStop(0,"rgba(50,250,250,1)"),h.addColorStop(1,"rgba(50,150,150,1)");let r="rgba(255,255,255,0.7)";te(e),e.scale(t.q.Rt,t.q.Rt),Ae(e,t.q.path,h,r,n.wt,n.st),ee(e)}},He=(t,e,n)=>{if(ke(e,t.K,t.K.list.map((t=>t.path)),n),n.N||n.L){let i=0,h=t.K.At,r=()=>{Xt(e,i,h,.1,Me(.2,.35))},a=()=>{me(e,"rgba(255,55,55,0.8)"),r(),me(e,"rgba(255,255,55,0.8)"),r()};n.N&&(i=t.K.Ot/2*.8-.1,a()),n.L&&(i=-t.K.Ot/2*.8,a())}},Re=(t,e,n)=>{ke(t,e.C,[e.C.path],n)};function Ae(t,e,n,i,h,r){te(t),me(t,i),t.fill(e),t.clip(e),me(t,n),zt(t,Math.cos(h)*r,Math.sin(h)*r,(()=>t.fill(e))),ee(t)}function Oe(t,e=1){return function(t,e,n,i){return"rgba("+t+","+e+","+n+","+i+")"}(t[0],t[1],t[2],e)}function je(t,e,n=1){return Oe(t.map((t=>Math.min(255,t+h(e)))),n)}function Te(t,e){let n=Be(t);return ze(n,e)}var ze=(t,e)=>{let n=function(t){return[h(55+50*t()),h(55+50*t()),h(55+50*t())]}(t),i=function(t){let e=h(155*t());return[e,e,e]}(t),r=Math.ceil(2+t()*(e+.01)*1e3),a=function(t,e,n){var i=Me(.5,1.5,t),h=Me(.5,2.5,t);let r={Ht:i,jt:Me(.5,2,t),Tt:h,zt:t()*h,Yt:i/2*t(),Rt:Me(.2,.5,t)};return r.path=Ve(r),r.F=3*n,r.G=3*n,r.bt=new Path2D,r.color=e,r}(t,n,r),o=function(t,e,n,i,h){let r=t.jt,a=t.Tt,o=-t.Tt/2,l=-t.Tt/2,s=Math.ceil(4*e()),u=[];for(let h=0;h<s;h++){let h=3*e()+Math.min(t.jt,t.Ht),s=4*e()+Math.min(t.jt,t.Ht),c=e()*t.Tt/2,M=t.Tt*(.3*e()),d=M+(t.Tt-M)*(.2*e()+.1),w=d+(t.Tt-d)*e()*.8,p=w+(t.Tt-w)*e(),m=e()<.5;var f=e()<.3?n:i;u.push({Ht:h,jt:s,It:M,Ct:d,lt:w,Lt:p,offsetTop:c,bt:new Path2D,color:f,Nt:m,path:Fe(h,s,M,d,w,p,-t.Tt/2,m)}),u[u.length-1].path.color=f,l>c-t.Tt&&(l=c-t.Tt),o<c+p-t.Tt&&(o=c+p-t.Tt,r=s,a=p)}let c=new Path2D;return u.forEach((t=>c.addPath(t.path))),{Ot:r,At:o,Vt:l,qt:a,W:s,list:u,path:c,color:n,bt:new Path2D,F:h,G:h}}(a,t,n,i,r),l=function(t,e,n,i){let h=Math.ceil(5*t()),r=e.jt,a=2*t()*e.jt,o=2.5*t()*a/(h+2),l=e.Tt/2,s=Math.ceil(1e3*t()*2)/1e3,u=(.5+.5*t())*s,f=s-u,c=a/(h+1),M=[];for(let t=1;t<=h;t++)M.push([-a/2+t*c-o/2,l+u]);return{Tt:s,Ct:u,lt:f,Kt:r,Wt:a,ot:o,top:l,W:h,Et:c,color:n,points:M,path:qe(l,r,u,a),kt:Ke(M,o,f),bt:new Path2D,F:i,G:i}}(t,a,n,r),s=function(t,e,n,i){let h=Math.ceil(3*t()*Math.min(1,z.level/100)),r=[Me(100,255,t),Me(100,255,t),Me(100,255,t)],a=.1+.15*t(),o=Math.max.apply(null,e.list.map((t=>t.jt))),l=Math.min.apply(null,e.list.map((t=>t.jt))),s=0-o/2+t()*(o/2-h*a),u=Math.max((0-s-h*a)/(h+1),0),f=1.2*e.qt*t(),c=e.At-e.qt,M=(.3+.5*t())*a,d=a,w=f*t(),p=f-w,m=M/2,g=d/2,b=[[-m,0],[-m,w],[-g,w],[-g,w+p],[g,w+p],[g,w],[m,w],[m,0]],x=new Path2D;x.rect(s,c,(a+u)*h*2+2*u,f);let y=t()<.5,v=Ye(h,b,s,u,a,c,y);return{Ft:M,Bt:d,Ct:w,lt:p,w:a,Tt:f,x:s,top:c,margin:u,W:h,Gt:o,Ut:l,color:n,ut:r,Nt:y,F:i,G:i,bt:new Path2D,path:v,gt:x}}(t,o,i,r);return{q:a,K:o,m:l,C:s}};function Ye(t,e,n,i,h,r,a){let o=new Path2D;for(let l=0;l<t;l++)o.addPath(Ee(e.map((t=>[t[0]+n+l*(i+h),t[1]+r])),a)),o.addPath(Ee(e.map((t=>[t[0]-n-l*(i+h),t[1]+r])),a));return o}function Ie(t,e,n){return t*n+e*(1-n)}function Le(t,e,n,i){let h={};return n.forEach((n=>{h[n]=Ie(t[n],e[n],i)})),h.color=Ne(t.color,e.color,i),h.bt=new Path2D,h.F=h.G,h}function Ne(t,e,n){return[t[0]*n+(1-n)*e[0],t[1]*n+(1-n)*e[1],t[2]*n+(1-n)*e[2]]}function Ve(t){let e=new Path2D;Et(e,-t.Ht/2,-t.Tt/2);let n=t.Ht/2,i=t.Tt/2;return e.bezierCurveTo(-n+t.Yt,-i-t.zt,n-t.Yt,-i-t.zt,n,-i),Kt(e,t.jt/2,i),Kt(e,-t.jt/2,i),Kt(e,-t.Ht/2,-i),e}function qe(t,e,n,i){let h=new Path2D;return Et(h,-e/2,t),Kt(h,e/2,t),Kt(h,i/2,t+n),Kt(h,-i/2,t+n),Kt(h,-e/2,t),h}function Ke(t,e,n){let i=new Path2D;return t.forEach((t=>{i.rect(t[0],t[1],e,n)})),i}function Ee(t,e){let n=new Path2D;if(e){Et(n,t[0][0],t[0][1]);let e=1;for(e=1;e<t.length-2;e++){let i=(t[e][0]+t[e+1][0])/2,h=(t[e][1]+t[e+1][1])/2;Ft(n,t[e][0],t[e][1],i,h)}Ft(n,t[e][0],t[e][1],t[e+1][0],t[e+1][1])}else{Et(n,t[0][0],t[0][1]);for(let e=1;e<t.length;e++)Kt(n,t[e][0],t[e][1])}return Kt(n,t[0][0],t[0][1]),n}function Fe(t,e,n,i,h,r,a,o){let l=new Path2D,s=[[0,a+n],[-t/2,a+i],[-e/2,a+h],[0,a+r],[e/2,a+h],[t/2,a+i],[0,a+n]];if(o){Et(l,s[0][0],s[0][1]);let t=1;for(t=1;t<s.length-2;t++){let e=(s[t][0]+s[t+1][0])/2,n=(s[t][1]+s[t+1][1])/2;Ft(l,s[t][0],s[t][1],e,n)}Ft(l,s[t][0],s[t][1],s[t+1][0],s[t+1][1])}else{Et(l,s[0][0],s[0][1]);for(let t=1;t<s.length;t++)Kt(l,s[t][0],s[t][1])}return l}var Be=t=>{return e=t,function(){var t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296};var e},Ge=(t,e)=>{let n=document.getElementById("b");n.style.margin=0,document.body.margin=0,n.width=t,n.height=e;let h=n.getContext("2d");for(let n=0;n<1e3;n++)me(h,Oe([125,155+100*i(),155+100*i()],.4)),Qe(h,i()*t,i()*e,2*i())},Ue=1,Je=(t,e,h,r,a)=>{Ue+=.1;for(let o=0;o<3;o++)me(e,je(a,Me(0,50),Me(0,1-t))),Gt(e),e.ellipse(h.x,h.y,r*t*i(),r*t*i(),.01*Ue%1.248*n,0,n,0),re(e),Ut(e)},Qe=(t,e,h,r)=>{let a=i()*n;t.lineWidth=.5*r,Gt(t),Xe(t,e,h,r,a),Xe(t,e,h,r,a+Math.PI),re(t),Ut(t)},Xe=(t,e,i,h,r)=>{let a=n/3;Et(t,e+Math.cos(r)*h,i+Math.sin(r)*h),Kt(t,e+Math.cos(r+a)*h,i+Math.sin(r+a)*h),Kt(t,e+Math.cos(r+2*a)*h,i+Math.sin(r+2*a)*h)},Ze="AEIOUY",$e="BCDFGHJKLMNPQRSTVWXY",_e=t=>{let e="";for(let n=Math.round(t());n<3+3*t();n++){let i=(n+1)%2?Ze[h(t()*(Ze.length-.1))]:$e[h(t()*($e.length-.1))];e+=0==e.length?i:i.toLowerCase()}return e+=["ian","ord","an","ar","'ok"][h(4.9*t())],e};var tn=t=>{let e="";for(let n=Math.round(t());n<5+3*t();n++)e+=n%2?Ze[h(t()*(Ze.length-.1))]:$e[h(t()*($e.length-.1))];var n;return e+=t()>.5?" "+((n=t())<.2?"IV.":n<.4?"V.":n<.6?"III.":n<.8?"II.":""):"",e},en=(t,n,i)=>{let h=Math.min(150,Math.max(30,window.innerWidth/8));y=.05;let l=oe(),s=ae("cont");a(l,le("Assimilation")),a(l,se("You destroyed all of the "+n.race+"s. Now steal their tech.")),a(l,s),a(l,se("Click Ship parts on the right to assimilate"));let u=ae("col"),f=ae("col"),c=ae("colWide"),M=ae("col"),d=ae("col"),w=fe(h,2*h),p=w.getContext("2d"),m=fe(h,2*h),g=m.getContext("2d");a(u,w),a(M,m);let b=!1,x={q:t.g.q,K:t.g.K,C:t.g.C,m:t.g.m};var v=t=>{qt(p,0,0,h,2*h),qt(g,0,0,h,2*h);let i={wt:-e,st:.1,U:!0,N:!0,L:!0};Pe(p,h/2,h,h/5,t,-e,i),Pe(g,h/2,h,h/5,n.g,-e,i),b||window.requestAnimationFrame((()=>v(t)))};v(x);let S=an;Object.values(S).forEach((t=>{t.Jt={},t.Qt={},t.Xt={}})),Object.keys(S).forEach((e=>{let i=ae("comp"),r=fe(h,h),l=r.getContext("2d");l.translate(h/2,h/2),l.scale(h/5,h/5),S[e].o(l,x),a(i,r);let s=ae("compWide"),u=ae("statCol"),M=ae("statCol"),w=ae("statCol"),p=ae("statCol"),m=ae("statCol");de(s,[u,M,w,p,m]),Object.entries(S[e].Zt).forEach((i=>{let h=i[0],r=i[1](t),o=ae("statValue"),l=ae("statValueChange"),s=ae("statValue2"),f=ae("statName");f.innerHTML=h,S[e].Jt[h]=o,S[e].Xt[h]=l,l.innerHTML="(+0)",S[e].Qt[h]=r,o.innerHTML=nn(S[e],h,r),s.innerHTML=nn(S[e],h,i[1](n)),a(u,o),a(M,l),a(w,f),a(m,s)}));let g=ae("comp clickable"),b=fe(h,h),y=b.getContext("2d");y.translate(h/2,h/2),y.scale(h/5,h/5),S[e].o(y,n.g),a(g,b),o(b,"click",(()=>{!function(t,e,n,i,h,r,a){Mn.J(sound.$t);let o,l,s,u,f=50,c=n[i],M=(t,h)=>{null!=t&&null!=h&&(!0,f--,a[i]=c._t(a,t,h,Math.max(.5,f/50)),"hull"!=i&&"thrust"!=i||(a.m.top=a.q.Tt/2,a.m.Kt=a.q.jt,a.m=n.m._t(a,a,a,.5)),qt(e,-150,-150,300,300),te(e),e.shadowBlur="15px",e.shadowColor="red",c.o(e,a),ee(e),f>0?window.requestAnimationFrame((()=>{M(t,h)})):!1)};t.classList.contains("selected")?(t.classList.remove("selected"),c.selected=!1,s=t=>c.Zt[t](h),u=()=>0,o=a,l=h.g):(f=50,t.classList.add("selected"),c.selected=!0,s=t=>(c.Zt[t](h)+c.Zt[t](r))/2,u=t=>{let e=c.Zt[t];e(h);let n=c.te&&c.te[t]?c.te[t]:hn;return n((e(h)+e(r))/2)-n(e(h))},o=h.g,l=r.g);Object.entries(c.Zt).forEach((t=>{let e=t[0];c.Jt[e].innerHTML=nn(c,e,s(e));let n=u(e);c.Xt[e].innerHTML="("+(n>=0?"+":"")+hn(n)+")",c.Xt[e].className=n>0?"plus":n<0?"minus":""})),M(o,l)}(g,l,S,e,t,n,x)})),a(f,i),a(c,s),a(d,g)})),de(s,[u,f,c,d,M]);let D=ue("Confirm",(()=>{t.g=x,l.style.height="0%",window.setTimeout((()=>{r(l),b=!0,Object.entries(S).filter((t=>t[1].selected)).forEach((e=>{switch(e[0]){case"wings":t.S=(t.S+n.S)/2;break;case"weapons":t.k=(t.k+n.k)/2,t.H=(t.H+n.H)/2,t.A=(t.A+n.A)/2,t.v=(t.v+n.v)/2,t.D=t.v/t.A;break;case"thrust":t.speed=(t.speed+n.speed)/2}})),i()}),300)}));a(l,D),window.setTimeout((()=>l.style.height="100%"),50)};function nn(t,e,n){let i=t.te&&t.te[e]?t.te[e]:hn,h=t.suffixes&&t.suffixes[e]?t.suffixes[e]:"";return i(n,1)+h}function hn(t,e){return 0==t?t:(e=e||Math.ceil(Math.abs(Math.log10(Math.abs(Math.max(-1,Math.min(1,t))))))+1,h(Math.pow(10,e)*t)/Math.pow(10,e))}var rn=()=>Object.keys(an).sort(((t,e)=>-("hull"==t?1:0))),an={C:{name:"Weapons",Zt:{ee:t=>t.g.C.G,ne:t=>t.H,ie:t=>t.k,he:t=>t.A,Range:t=>t.D*t.A},te:{ne:t=>hn(60/t,3),he:t=>hn(100*t,1)},suffixes:{ne:"/s",he:"km/s"},o:(t,e)=>{zt(t,0,1,(()=>Re(t,e,.5,.5)))},_t:(t,e,n,i)=>((t,e,n)=>{let i=Le(t,e,["w","x","top","margin","h","topW1","topW2","h1","h2","maxHp"],n),h=i.Ft/2,r=i.Bt/2,a=[[-h,0],[-h,i.Ct],[-r,i.Ct],[-r,i.Ct+i.lt],[r,i.Ct+i.lt],[r,i.Ct],[h,i.Ct],[h,0]];return i.W=e.W,i.gt=new Path2D,i.gt.rect(i.x,i.top,(i.w+i.margin)*i.W*2+2*i.margin,i.Tt),i.Nt=t.Nt^e.Nt,i.path=Ye(i.W,a,i.x,i.margin,i.w,i.top,i.Nt),i.Gt=Math.min(t.Gt,e.Gt),i.Ut=Math.max(t.Ut,e.Ut),i.ut=Ne(t.ut,e.ut,n),i})(e.C,n.C,i)},q:{name:"Hull",Zt:{ee:t=>t.g.q.G},o:(t,e)=>Ce(e,t,.5,.5),_t:(t,e,n,i)=>function(t,e,n){let i=Le(t,e,["topW","bottomW","h","controlTop","controlSide","windowSize","maxHp"],n);return i.path=Ve(i),i}(e.q,n.q,i)},K:{name:"Wings",te:{re:t=>hn(100*t,3)},Zt:{ee:t=>t.g.K.G,re:t=>t.S},o:(t,e)=>He(e,t,.5,.5),_t:(t,e,n,i)=>function(t,e,n,i){let h=[];for(let r=0;r<n.list.length;r++)if(e.list[r]&&n.list[r]){let a=e.list[r],o=n.list[r],l=Le(a,o,["topW","bottomW","h0","h1","h2","h3"],i);l.offsetTop=Ie(a.offsetTop,o.offsetTop,i),l.path=Fe(l.Ht,l.jt,l.It,l.Ct,l.lt,l.Lt,-t/2,a.Nt^o.Nt),h.push(l)}else h.push(n.list[r]);let r=new Path2D;h.forEach((t=>r.addPath(t.path)));let a=Le(e,n,["maxW","maxY","minY","maxH","maxHp"],i);return a.W=n.W,a.list=h,a.path=r,a}(t.q.Tt,e.K,n.K,i)},m:{name:"Thrust",te:{ae:t=>hn(1e3*t,3)},Zt:{ee:t=>t.g.K.G,ae:t=>t.speed},o:(t,e)=>zt(t,0,-5/4,(()=>We(e,t,.5,.5,!0))),_t:(t,e,n,i)=>((t,e,n,i)=>{let h=Le(e,n,["h","w1","w2","h1","h2","tw","maxHp"],i);h.W=n.W,h.top=Ie(e.top,t.Tt/2,i),h.Et=h.Wt/(h.W+1),h.points=[];for(let t=1;t<=h.W;t++)h.points.push([-h.Wt/2+t*h.Et-h.ot/2,h.top+h.Ct]);return h.path=qe(h.top,h.Kt,h.Ct,h.Wt),h.kt=Ke(h.points,h.ot,h.lt),h})(t.q,e.m,n.m,i)}},on=440,ln=523.3,sn=392,un=439.9,fn=587.3;let cn=[[on,ln,659.3],[sn,un,fn],[349.2,on,ln],[sn,un,fn]];var Mn,dn=[.25,.5,1,2,4],wn=!1;class pn{constructor(){this.oe=new AudioContext,this.le(),this.se=0,this.ue=0,this.fe=0,this.ce=0,this.Me=1.5,this.de=[2,.25,.25,.5],this.we=.8,this.pe={}}me(){let t=dn[h(i()*dn.length)],e=cn[this.se][h(3*i())];this.ge(this.oe,e,Me(.1,.05),this.time,this.fe-this.time,t*this.we,"triangle"),this.fe+=t}le(){if(!wn){if(this.time=this.oe.currentTime,this.ue-this.time<1){this.se++,this.se=this.se%cn.length;let t=0;this.de.forEach(((e,n)=>{this.be(this.oe,cn[this.se],this.ue-this.time+t,e*this.we),t+=e})),this.ue+=t}this.fe-this.time<1&&this.me()}window.requestAnimationFrame(this.le.bind(this))}be(t,e,n,i){let h=.05/e.length,r=t.currentTime;e.forEach((e=>{this.ge(t,e,h,r,n,i)}))}ge(t,e,n,i,h,r,a){var o=t.createOscillator(),l=t.createGain();l.gain.value=0,l.gain.setValueAtTime(0,i+h),l.gain.linearRampToValueAtTime(n,i+h+.25),l.gain.setValueAtTime(n,i+h+r),l.gain.exponentialRampToValueAtTime(1e-5,i+h+r+1),o.type=a||"sine",o.connect(l),o.frequency.value=e,o.start(i+h),o.stop(i+h+r+2),l.connect(t.destination),window.setTimeout((()=>{l.disconnect(),o.disconnect()}),1e3*(h+r+2))}J(t,e=1){let n=t.id;if(wn)return;e*=t.xe*Me(.9,1.1),l(this.pe,n)||(this.pe[n]=[]);let i=this.pe[n];if(i.length>t.max)return;let h=this.oe,r=h.currentTime,a=h.createOscillator();a.frequency.value=t.ye*Me(.9,1.1),a.type=t.type||"sine";let o=h.createGain();o.gain.value=0,o.gain.setValueAtTime(0,r),t.ve.forEach((t=>{o.gain.linearRampToValueAtTime(t[1],r+e*t[0])})),t.Se&&t.Se.forEach((t=>{a.frequency.exponentialRampToValueAtTime(t[1],r+e*t[0])})),a.connect(o),a.start(r),a.stop(r+e),o.connect(h.destination),i.push(a),window.setTimeout((()=>{o.disconnect(),a.disconnect(),i.splice(i.indexOf(a),1)}),1e3*(e+.1))}}var mn={Y:{ve:[[.1,.03],[.1,.08],[1,0]],ye:140,xe:.1,max:5,id:"shoot"},yt:{ve:[[.1,.5],[.15,.1],[.2,.4],[.25,.1],[.3,.3],[.4,.1],[1,0]],ye:30,xe:1,type:"sine",max:5,id:"hit"},X:{ve:[[.1,.5],[.12,.1],[.14,.5],[.16,.1],[.18,.5],[1,0]],ye:40,xe:.6,max:2,id:"explosion"},$t:{ve:[[.1,.1],[.9,.1],[1,0]],Se:[[1,440]],ye:80,xe:.5,max:1,id:"merge"}}}();