!function(){var t=!0,e=Math.PI/2,n=2*Math.PI,h=Math.random,i=Math.floor,a=t=>document.body.removeChild(t),r=(t,e)=>t.appendChild(e),o=(t,e,n)=>t.addEventListener(e,n),l=(t,e)=>t.hasOwnProperty(e);var s,u,c,f,M,d=new class{constructor(){this.t={}}h(t,e,n,h,i){this.t[t]={i:e,o:n,l:h,max:i,list:[]}}o(t){t.map((t=>this.t[t])).forEach((t=>{t.i();for(let e=t.list.length-1;e>=0;e--)--t.list[e][0]>0?t.o(t.list[e]):t.list.splice(e,1);t.l()}))}add(t,e){this.t[t].list.push(e),this.t[t].list.length>this.t[t].max&&this.t[t].list.splice(0,1)}},w=window.innerWidth,p=window.innerHeight,m={x:0,y:0};let g=i(99999*h());console.log("Ship seed: "+g);var b,x,y=25,S=3500,v={x:0,y:0},D=0,P={},k=!1,C={},W=new Set,H=6e3,A=.01,O=!1,R=window.performance.now(),j=0,T={},Y={},z=0,I={},N={};let F={};var L,V,B=[],E={},G={},q=0;function J(){g=i(99999*h());let t=Ne(g),n={x:i(1e4*t()),y:i(1e4*t())};for(;!lt(n)||!st(n.x,n.y).u.length;)n={x:i(1e4*t()),y:i(1e4*t())};m=ft(st(n.x,n.y).u[0],D),Y.level=500,(Y=ct(t,g)).x=m.x+25,Y.y=m.y+25,Y.level=500,Y.M=-e,Y.p=le(0,0),Y.m=le(0,0),Y.g=Ce(g,Y.level/500)}class K{constructor(t){this.seed=t.seed,this.g=Ce(t.seed,Y.level/500),this.race=t.race,this.S=t.S,this.v=t.v,this.speed=t.speed,this.D=t.D,this.P=0,this.k=t.k/this.g.W.C,this.H=t.H,this.A=t.A,this.O=t.O||.02,this.R=t.R,this.size=t.size;let e=this.j();this.x=e.x,this.y=e.y,this.p={x:0,y:0},this.T=0,this.M=h()*n}Y(){Z(this)}update(){let t=xt(this,Y);this.P>0&&(this.P-=1*(this.g.W.I?.5:1)),t<this.A?(t<this.S&&(!this.g.W.I&&this.P<=0&&(this.Y(),this.P=this.H),this.N=this.F=!1),this.L=Y,b||(b=this),this.moveTo(Y)):(this.L==Y&&t>this.A*(kt(nt(this),nt(Y))?5:2.5)&&(this.L=null),(!this.L||xt(this.L,this)<5)&&(this.L=this.j()),this.L.x==this.x&&this.L.y==this.y&&this.L.x++,this.moveTo(this.L)),de(this.p,.99),Me(this,this.p),at(this,!1),[this.g.V,this.g.m,this.g.B,this.g.W].forEach((t=>{t.G<=0&&!t.I&&(t.I=!0,t!=this.g.W&&(rt(this,t),Q(this,.4)))})),this.g.V.I&&(this.I=!0,Q(this),Y.level+=1)}j(){if(this.R.u){let t=ft(this.R.u[i(h()*this.R.u.length)],D);return we(t,re(0,n),re(0,40)),t}return le(this.R.q.x+re(-1,1)*this.R.size,this.R.q.y+re(-1,1)*this.R.size)}o(){let t=Mt(this.x,this.y),e=this.size*y*6,n=b==this;if((xt(v,t)<1*e||n)&&null==x){n||(x=this),ue(f,"green"),f.textBaseline="top",me(f,14);let h=t.x-60,i=t.y-40-e/2;Gt(f,this.race+" Ship",h,i-20),me(f,14),Ze().forEach(((e,n)=>{let a=i+13*n;Gt(f,$e[e].name,h,a),Et(f,t.x,a+5,60*this.g[e].G/this.g[e].J,5)}))}if(f.lineWidth=n?3:2,ce(f,"rgba(200,50,50,0.3)"),Bt(f,t.x-e/2,t.y-e/2,e,e),function(t,e){return t.x>-e&&t.x<w+e&&t.y>-e&&t.y<p+e}(t,y))ht(this,this.K,this.F,this.N,!0);else{let e=Ct(t.x,0,w),n=Ct(t.y,0,p);ue(f,"rgba(200,50,50,0.7)"),f.lineWidth=3,Ft(f),Ee(f,e,n,18,vt(t.x,t.y,e,n)),Lt(f),$t(f)}}moveTo(t){let e=St(t,this);if(Dt(e,this.M)<2*this.v)this.M=e;else{let t=.05*-this.v*Pt(e,this.M+Math.PI,this.v);t>0?this.F=!0:t<0&&(this.N=!0),this.T+=t*(this.g.B.I?.1:1)}this.M+=this.T,this.T*=.9+(this.g.B.I?.09:0);let n=xt(this,t),h=Math.min(1,n/this.S)*this.speed*(this.g.m.I?.1:1);we(this.p,this.M,h),this.K=!0}}function Q(t,e=1){for(let n=0;n<25;n++){let i=.05*y;window.setTimeout((()=>{d.add(1,[36,re(-i,i),re(-i,i),t,h()<.5?[255,re(50,255),re(50,100)]:pt(t.seed),re(1,3)*e])}),15*n)}}function U(){w=window.innerWidth,p=window.innerHeight,s.width=w,s.height=p,u.width=w,u.height=p,c.width=w,c.height=p,Fe(w,p)}function X(){if(!t){let n=window.performance.now();for(j+=n-R,R=n;j>16;)j-=16;D+=1,function(){!function(){L=nt(Y),V=Object.values(Y.g).forEach((e=>{if(!e.I&&e.G<=0&&(e.I=!0,e==Y.g.V))return Object.values(Y.g).filter((t=>t!=Y.g.W)).forEach((t=>rt(Y,t))),Y.I=!0,Q(Y),void window.setTimeout((()=>{t=!0,function(){let e=te(),n=he("Continue anyway",(()=>{!function(){Object.values(Y.g).forEach((t=>{t.G=t.J,t.I=!1})),Y.I=!1;let e=nt(Y);if(lt(e)){let t=st(e.x,e.y);fe(Y,t.q.x-t.size,t.q.y-t.size)}else fe(Y,e.x*S,e.y*S);de(Y.p,0),t=!1}(),a(e)})),h=he("Start another game",(()=>{I={},N={},E={},J(),a(e),t=!1}));oe(e,[ee("Oh no. You died."),n,h]),window.setTimeout((()=>e.style.height="100%"),50)}()}),2500)}));let n=Y.g;lt(L)?(function(t){t.u.forEach((t=>{let e=ft(t,D),n=ft(t,D+1),h=xt(Y,e);if(h<10*t.rad){let i=St(Y,e);Y.p.x+=(.1*Math.cos(i)*t.rad+.5*(n.x-e.x))/Math.max(t.rad,h)**2,Y.p.y+=(.1*Math.sin(i)*t.rad+.5*(n.y-e.y))/Math.max(t.rad,h)**2}}));let e=St(Y,t.q),n=xt(t.q,Y);Y.p.x+=.1*Math.cos(e)*t.U/Math.max(t.U,n)**2,Y.p.y+=.1*Math.sin(e)*t.U/Math.max(t.U,n)**2}(V=st(L.x,L.y)),Y.X=!1,Y.Z=!1,V.u.forEach((t=>{xt(Y,ft(t,D))<t.rad&&Object.values(n).forEach((t=>{Y.X=!0,t.G=Math.min(t.J,t.G+t.J/1e3),t.G==t.J?t.I=!1:Y.Z=!0}))}))):V=null;let h=Y.speed*(n.m.I?.25:1),i=Y.v*(n.B.I?.5:1);(P.$||P._)&&we(Y.m,Y.M,h);(P.tt||P.et)&&we(Y.m,Y.M,-h);let r=-Pt(vt(w/2,p/2,v.x,v.y),Y.M,i*(n.B.I?.1:1));Y.F=Math.max(0,r<0?10:Y.F-1),Y.N=Math.max(0,r>0?10:Y.N-1),Dt(vt(w/2,p/2,v.x,v.y),Y.M)<i?Y.M=vt(w/2,p/2,v.x,v.y):Y.M+=r*i;(P.nt||P.ht)&&we(Y.m,Y.M+e,-h);(P.it||P.at)&&we(Y.m,Y.M+e,h);if(Me(Y.p,Y.m),gt()>299792){let t=gt()/299792;de(Y.p,1/t)}Me(Y,Y.p),de(Y.m,0),at(Y,!0)}();for(let t=0;t<1;t++)_();Y.P>0&&(Y.P-=1*(Y.g.W.I?.5:1));k&&!Y.I&&Y.P<=0&&(Y.P=Y.H,tn.rt(an),Z(Y));for(let t=L.x-1;t<=L.x+1;t++)for(let e=L.y-1;e<=L.y+1;e++)V&&xt(V.q,Y)<S&&ut(t,e).forEach((t=>{(xt(t,Y)<1e3||et(t,Y))&&W.add(t)}));W.forEach((t=>t.update())),W.forEach((t=>{xt(t,Y)>1e3&&t.L!=Y&&!et(t,Y)&&kt(nt(t),t.R)&&W.delete(t)})),W.forEach((e=>{if(e.I){let n=ut(e.R.x,e.R.y);n.splice(n.indexOf(e),1),W.delete(e),0==n.length&&window.setTimeout((()=>{t=!0,Qe(Y,e,(function(){Y.level+=3,R=window.performance.now(),t=!1}))}),500)}}))}(),function(){if(f.clearRect(0,0,w,p),b&&!b.I){let t=Mt(b.x,b.y),e=yt(w/2,p/2,t.x,t.y),n=Math.min(w,p-300)/2;e>1.5*n?y=Math.min(H,Math.max(A,Math.max(y-.02,.99*y))):e<.5*n&&(y=Math.min(H,Math.max(A,Math.min(y+.02,1.01*y))))}let t={ot:i((m.x-w/2/y)/S),lt:i((m.x+w/2/y)/S),st:i((m.y-p/2/y)/S),ut:i((m.y+p/2/y)/S)};null,null,m={x:Y.x,y:Y.y};for(let e=t.ot;e<=t.lt;e++)for(let n=t.st;n<=t.ut;n++)tt(e,n);d.o([4,3]),x=null,W.forEach((t=>t.o())),f.lineWidth=.5,Object.entries(C).forEach((t=>{let e=t[0],n=t[1];Rt(f,n.map((t=>[dt(t[0]),wt(t[1]),Math.max(1.5,.1*y)*(t[5]<50?t[5]/50:1)])),n.length?Pe(pt(e)):"black","black")})),function(){let t=Y.x,n=Y.y;++z>10&&(z=0,B.push([t,n]),B.length>500&&B.splice(0,1));if(Y.I)return;if(y<5){let e=Mt(t,n);if(f.lineWidth=1,Tt(f,e,pe(e,Y.M,30),"rgb(50,150,50,0.8)"),Ft(f),ce(f,"rgba(255,255,255,0.3)"),B.length){let t=Mt(B[0][0],B[0][1]);zt(f,t.x,t.y),B.forEach((e=>{t=Mt(e[0],e[1]),Yt(f,t.x,t.y)})),Yt(f,e.x,e.y),Vt(f),Lt(f)}}let i=P.$||P._;i&&Y.g.m.points.filter((t=>h()<.6)).forEach((t=>{let n=t[0]+Y.g.m.ct*h(),i=we(pe(Y,Y.M-e,-n),Y.M,-t[1]-Y.g.m.ft);d.add(3,[re(5,50),i.x,i.y,Y.M+re(-.1,.1),re(40,60)])}));ht(Y,i,Y.F,Y.N,!1),y>5e3&&(me(f,p/2*y/5e3*Y.size),f.textBaseline="top",ue(f,"black"),Gt(f,"üë®‚ÄçüöÄ",w/2-qt(f,"üë®‚ÄçüöÄ")/2,p/2),f.font="12px Arial")}(),d.o([0,1,2]),mt()}()}window.requestAnimationFrame(X)}function Z(t){let n=t.g.W;for(let h=0;h<n.C;h++){let i=n.x+ +h*(n.w+n.margin),a=Wt(t.size*i,t.size*n.top),r=Me(we(le(0,0),t.M,t.O),t.p),o=Wt(r.x,r.y).Mt;$(t.seed,t.x+Math.cos(t.M+e+a.angle)*a.Mt,t.y+Math.sin(t.M+e+a.angle)*a.Mt,t.M,o,t.k,t.D,n.dt),a=Wt(t.size*-i,t.size*n.top),$(t.seed,t.x+Math.cos(t.M+e+a.angle)*a.Mt,t.y+Math.sin(t.M+e+a.angle)*a.Mt,t.M,o,t.k,t.D,n.dt)}}function $(t,e,n,h,i,a,r,o){l(C,t)||(C[t]=[]),C[t].push([e,n,h,i,a,r,o])}function _(){Object.values(C).forEach((t=>{for(let e=t.length-1;e>=0;e--){let n=t[e];n[0]+=Math.cos(n[2])*n[3],n[1]+=Math.sin(n[2])*n[3],(--n[5]<=0||n[0]<m.x-3*w/y||n[1]<m.y-3*p/y||n[0]>m.x+3*w/y||n[1]>m.y+3*p/y)&&t.splice(e,1)}}))}function tt(t,e){if(f.lineWidth=.1,lt({x:t,y:e})){let i=st(t,e),a=Ne(i.seed),r=Mt(i.q.x,i.q.y),o=xt(r,v)<i.size*y;if(o&&i,y<.5&&o){ce(f,"green"),ue(f,"green"),f.lineWidth=.5;let t=i.name;me(f,16);var h=i.size*y*2;Bt(f,r.x-h/2,r.y-h/2,h,h),Gt(f,t,r.x-qt(f,t)/2,r.y-h/2-18)}let l=i.U*y,s=r.x,u=r.y;At(f,s,u,l-10*y,i.wt(y,1));for(let t=0;t<Math.min(60,Math.max(5,30*Math.log(y)));t++)ue(f,Pe([255,re(100+1/y,255,a),re(50+1/y,255,a),a],.09/Ct(y,.1,5))),Ft(f),f.ellipse(s,u,l*(.8+.4*a()*Math.abs(a()*t*.01%1-.5)),l*(.8+.4*a()*Math.abs((a()*t*.01+.5)%2-1)),a()*n+Math.abs((a()*t*.01+.5)%2-1),0,n,0),$t(f),Lt(f);!function(t){ce(f,"white"),f.lineWidth=.1,t.u.filter((t=>t.rad*y>1)).forEach((t=>function(t){let e=ft(t,D),n=Mt(e.x,e.y);xt(n,v)<t.rad*y&&t;let h=t.gt+D*t.bt;Kt(f),At(f,n.x,n.y,t.rad*y,t.wt),Jt(f),Ft(f);let i="rgba(255,255,255,0.5)",a=pe(n,h,-t.rad*y*1.7);y>.05&&(i=f.createRadialGradient(a.x,a.y,0,a.x,a.y,t.rad*y*3),i.addColorStop(0,Pe([255,255,255],.5)),i.addColorStop(1,Pe([0,0,0],0)));At(f,a.x,a.y,t.rad*y*2,i);let r=(n,i)=>{let a=Mt(n.x,n.y),r=xt(n,e);if(r<5*t.rad){let e=pe(a,h,Math.sqrt(r*y*150+150));ue(f,t.wt),ge(f,e.x,e.y,.95*y,n.g,n.M,{fill:t.wt,xt:i})}};r(Y,!1),W.forEach((t=>r(t,!0))),Qt(f)}(t)))}(i)}}function et(t,e){return kt(nt(t),nt(e))}function nt(t){return{x:i(t.x/S),y:i(t.y/S)}}function ht(t,n,h,a,r){let o=i(t.x/S),l=i(t.y/S),s=st(o,l),u=lt({x:o,y:l}),c=u?s.size-xt(t,s.q):0;t.size=1;let M=u?c/s.size*.25:0,d=Mt(t.x,t.y);ge(f,d.x,d.y,1*y,t.g,t.M,{yt:u?St(s.q,t):-1-t.M-e,Mt:M,xt:r,K:n,F:h,N:a})}function it(){J();let n=te(),h=ie(300,300),i=!1,r=h.getContext("2d"),o=()=>{r.clearRect(0,0,300,300),Ht(r,150,150,(()=>{Kt(r),Xt(r,40,40),ge(r,0,0,1,Y.g,-e,{yt:vt(v.x,v.y,w/2,h.getBoundingClientRect().top+150),Mt:.2,K:!0,F:!0,N:!0}),Qt(r),i||window.requestAnimationFrame(o)}))};o();let l=ne(Y.race);oe(n,[_t(""),ee("Choose a race"),l,h,he("New Race",(()=>{J(),l.innerHTML=Y.race})),_t(""),_t(""),he("Confirm",(()=>{i=!0,a(n),t=!1})),_t(""),_t(""),_t("")]),n.style.height="100%"}function at(t,n){Object.entries(C).filter((e=>e[0]!=t.seed)).forEach((h=>{let i=h[0],a=h[1];for(let h=a.length-1;h>=0;h--){let u=a[h],c=(r=u[0],o=u[1],l=t.x,s=t.y,{angle:vt(r,o,l,s),Mt:yt(r,o,l,s)}),M=Math.cos(c.angle-t.M+e)*c.Mt,w=Math.sin(c.angle-t.M+e)*c.Mt;Object.keys($e).forEach((e=>{let r=t.g[e];if((!r.I||n)&&f.isPointInPath(r.St?r.St:r.path,M,w))return a.splice(h,1),zt(r.vt,M,w),Nt(r.vt,M,w,re(.02,.1)),r.G=Math.max(0,r.G-u[4]),r.Dt=15,tn.rt(rn),d.add(0,[re(10,20),M,w,t,pt(i)]),void d.add(2,[re(5,30),u[0]+re(-1,1),u[1]+re(-1,1)])}))}var r,o,l,s}))}function rt(t,n){d.add(4,[250,se(t),se(t.p),t.M+e,t.size,n])}function ot(t){return Pe([Math.min(255,i(75*t())),Math.min(255,i(75*t())),Math.min(255,i(75*t()))],1)}function lt(t){return l(I,t.x)||(I[t.x]={}),l(I[t.x],t.y)||(I[t.x][t.y]=Ne(""+Math.abs(10*t.x+345)*Math.abs(3*t.y+213)%1234)()>.9),I[t.x][t.y]}function st(t,e){if(!lt({x:t,y:e}))return{};if(l(N,t)||(N[t]={}),!l(N[t],e)){let h=t>e?-2*t-1:2*t,a=t>e?-2*e-1:2*e,r=(h+a)*(h+a+1)*.5+a,o=Ne(r);l(F,r)||(F[r]=[t,e]);let s=60+60*o(),u=(.1*Math.sign(o()-o())+.2*(o()-o()))*S,c=(.1*Math.sign(o()-o())+.2*(o()-o()))*S,M={x:t*S+1750+u,y:e*S+1750+c},d=.95*(1750-Math.max(Math.abs(u),Math.abs(c)))-20,w=2+i(9*o()),p=[],m=2*s;for(let h=0;h<w&&m<d;h++){let i=15+15*o(),a=Math.max(2*i+i*o(),(d-m-2*i)/(w-h)*o()),r={rad:i,Pt:m+a,bt:.0012*o()+5e-4,kt:.002*o()+.001,gt:o()*n,Ct:M,wt:ot(o),Wt:[t,e],index:h};m+=a+i,p.push(r)}let g=o(),b=o(),x=(t,e)=>function(t,e,n,h){let a=Math.min(255,5*-t+10+i(200*n)),r=Math.min(255,5*-t+10+i(200*h));ue(f,Pe([Math.max(a,Math.min(50*t,255)),a,r],e))}(s*t,1,g,b),y=Ke(o);N[t][e]={q:M,u:p,U:s,size:m,wt:x,name:y,seed:r,x:t,y:e}}return N[t][e]}function ut(t,e){if(T[t]&&T[t][e]||!lt({x:t,y:e}))return[];if(l(E,t)||(E[t]={}),!l(E[t],e)){E[t][e]=[];let n=st(t,e),h=n.seed,i=Ne(h),a=Math.ceil(3+12*i()*Y.level/500),r=ct(i,h);r.R=n;for(let n=0;n<a;n++)E[t][e].push(new K(r))}return E[t][e]}function ct(t,e){let n=[.5,.6,.6,1,1,1.1,1.1,1.2].sort(((e,n)=>re(-1,1,t))),h=()=>n.shift()+re(-.1,.1,t),i=Math.min(500,Y.level)/500;var a=re(9,9+500*i,h),r=.1+1.9*i*h();let o=.003+.017*Y.level/500*h();return{seed:e,S:a,v:.05+.04*i*h(),speed:o,A:Math.max(75,a*(1+h())),k:Math.ceil(1+800*i*h()),H:Math.min(30,30-Math.ceil(Math.log(1+500*i)/Math.log(501)*28*h())),O:r,size:1+h(),D:a/r,P:0,race:Je(t)}}function ft(t,e){let n=t.gt+e*t.bt;return{x:t.Ct.x+Math.cos(n)*t.Pt,y:t.Ct.y+Math.sin(n)*t.Pt}}function Mt(t,e){return{x:dt(t),y:wt(e)}}function dt(t){return w/2-m.x*y+t*y}function wt(t){return p/2-m.y*y+t*y}function pt(t){if(!l(G,t)){let e=Ne(t);G[t]=[i(155+100*e()),i(155+100*e()),i(155+100*e())]}return G[t]}window.onload=()=>{s=document.getElementById("c"),u=document.getElementById("b"),c=document.getElementById("h"),f=s.getContext("2d"),M=c.getContext("2d");let t=null;o(window,"resize",(()=>{clearTimeout(t),t=window.setTimeout(U)})),U(),o(window,"keydown",(t=>{P[t.code]=!0})),o(window,"keyup",(t=>P[t.code]=!1)),o(window,"mousedown",(t=>{k=!0,v={x:t.clientX,y:t.clientY},x&&(b=x)})),o(window,"mouseup",(t=>{k=!1,O=!1}));let n=document.getElementById("zoomHandle"),i=document.getElementById("zoomBar"),r=()=>{n.style.top=i.clientHeight-Ct(y/(Math.log10(H)-Math.log10(A))*i.clientHeight,0,i.clientHeight)+"px"};r(),o(n,"mousedown",(t=>{t.preventDefault(),O=t.clientY-n.getBoundingClientRect().top}));let l=t=>{let e=i.getBoundingClientRect(),h=Math.max(.1,Math.min(i.clientHeight,t.clientY-e.top-O));return n.style.top=Math.min(i.clientHeight,Math.max(0,h))+"px",Ct(Math.max(.1,i.clientHeight-h)/i.clientHeight*(Math.log10(H)-Math.log10(A)),A,H)};o(i,"mousedown",(t=>{O=0,y=l(t),O=!0})),o(window,"mousemove",(t=>{O&&(y=l(t)),k&&(m.x+=(v.x-t.clientX)/y,m.y+=(v.y-t.clientY)/y),v.x=t.clientX,v.y=t.clientY}));let w=!1;o(window,"wheel",(t=>{if(w)return;w=!0,b=null;let e=t.wheelDelta?t.wheelDelta:-1*t.deltaY,n=(e+1)/(Math.abs(e)+1)*Math.min(Math.abs(e));var h=n/Math.abs(n);y=Math.min(H,Math.max(A,y*(h<0?.95:1.05))),w=!1,r()})),function(){d.h(3,(()=>ue(f,"rgba(255,255,255,0.3)")),(t=>{let e=(60-t[4])/3e3;t[1]-=Math.cos(t[3])*e,t[2]-=Math.sin(t[3])*e,t[4]*=.999;let n=Mt(t[1],t[2]),i=.3*t[4]/150*(.2+.8*h())*y;Rt(f,Array.apply(null,Array(Math.ceil(5*h()))).map((t=>[n.x+re(-i,i),n.y+re(-i,i),i])),"rgba(255,255,255,0.3)")}),(()=>{}),250);let t=(t,n,h)=>{let i=Wt(t[1],t[2]),a=pe(le(0,0),i.angle+e+t[3].M,i.Mt);Ve(h,f,Mt(t[3].x+a.x,t[3].y+a.y),n,t[4])};d.h(0,(()=>{}),(e=>t(e,Ct(y,3,9),e[0]/10)),(()=>{}),250),d.h(1,(()=>{}),(e=>t(e,e[3].size*e[5]*y,Math.abs(e[0]-18)/18)),(()=>{}),250),d.h(2,(()=>{}),(t=>{let e=Mt(t[1],t[2]),n=re(.1*y,.2*y);Rt(f,Array.apply(null,Array(Math.ceil(5*h()))).map((t=>[e.x+re(-n,n),e.y+re(-n,n),n])),"rgba(255,255,255,0.3)")}),(()=>{}),250),d.h(4,(()=>{}),(t=>{let n=t[1],h=t[2],i=Mt(n.x,n.y);Ht(f,i.x,i.y,(()=>{ae(f,y*t[4],t[3]+e),ue(f,Pe(t[5].color)),f.fill(t[5].path)})),Me(n,h),t[3]+=.04,t[4]*=.99}),(()=>{}),250)}(),function(){let t=te();oe(t,[_t(""),ee("Space"),ne("Mouse to aim. </br> WASD or Arrow keys to thrust. </br> Click to shoot. </br> Scroll to Zoom "),he("Start game",(()=>{J(),a(t),tn=new hn,it()})),he("Start muted",(()=>{J(),a(t),it()})),_t("")]),t.style.height="100%"}(),X()};var mt=()=>{M.font="24px Arial",M.clearRect(0,0,w,p),function(){ue(M,"green");let t=gt();me(M,17);let e="Current Speed: "+t+"km/s",n=qt(M,e);Gt(M,e,w/2-n/2,280);let h=Math.min(45,50*yt(0,0,Y.p.x,Y.p.y)),i=vt(0,0,Y.p.x,Y.p.y);M.lineWidth=2,At(M,w/2,175,90,"black"),Ot(M,w/2,175,90,"green"),M.lineWidth=2,Ft(M),zt(M,w/2,175),Yt(M,w/2+Math.cos(i)*h,175+Math.sin(i)*h),Ee(M,w/2+Math.cos(i)*(h+7.5),175+Math.sin(i)*(h+7.5),10,i),Lt(M),Vt(M),Qt(M)}(),V&&V.u?function(){q++;let t=w-330,e=25;Kt(M),ue(M,"black"),Ft(M),Ut(M,t,e,300,300),Jt(M),$t(M),Lt(M),ue(M,"green"),Bt(M,t,e,300,300),M.lineWidth=.4,Ft(M);for(let n=0;n<6;n++)zt(M,t,e+300*n/6),Yt(M,t+300,e+300*n/6),zt(M,t+300*n/6,e),Yt(M,t+300*n/6,e+300);Vt(M),Lt(M);let n=1.2*V.size/150,h=e=>t+150+(e-V.q.x)/n,i=t=>e+150+(t-V.q.y)/n;At(M,t+150,e+150,V.U/n,"green"),V.u.forEach((t=>{let e=ft(t,D);At(M,h(e.x),i(e.y),Math.max(3,t.rad/n),"green")})),Lt(M),$t(M);let a=(n,a,r)=>{At(M,Math.max(t,Math.min(t+300,h(n.x))),Math.max(e,Math.min(e+300,i(n.y))),a,r)},r=ut(V.x,V.y);r.forEach((t=>{a(t,2+3*Math.abs(Math.abs(q-100)%200-100)/100,"red")})),a(Y,2+3*Math.abs(q%200-100)/100,"yellow");let o=h(Y.x),l=i(Y.y);if(ce(M,"yellow"),M.globalAlpha=.5,M.lineWidth=.5,Ft(M),B.length){let t=h(B[0][0]),e=i(B[0][1]);zt(M,t,e),B.forEach((n=>{t=h(n[0]),e=i(n[1]),Yt(M,t,e)})),Yt(M,o,l),Vt(M),Lt(M)}M.globalAlpha=1;let s=V.name||" ",u=qt(M,s);ue(M,"green"),Gt(M,s,w-175-u/2,30),s="Hostile Ships: "+r.length,u=qt(M,s),r&&Gt(M,s,w-175-u/2,300);Qt(M)}():function(){q++;let t=w-330,e=25;ue(M,"black"),Et(M,t,e,300,300),ue(M,"green"),Bt(M,t,e,300,300),Kt(M),Ut(M,t,e,300,300),Jt(M),M.lineWidth=.2,Ft(M);for(let n=0;n<8;n++)zt(M,t,i(e+300*n/8)),Yt(M,t+300,i(e+300*n/8)),zt(M,i(t+300*n/8),e),Yt(M,i(t+300*n/8),e+300);Vt(M),Lt(M);let n=4,h=nt(Y),a=S*n*2/300,r=e=>t+150+(e-Y.x)/a,o=t=>e+150+(t-Y.y)/a;for(let t=h.x-n;t<h.x+n;t++)for(let e=h.y-n;e<h.y+n;e++)if(lt({x:t,y:e})){let h=st(t,e);At(M,r(h.q.x),o(h.q.y),h.U/(S*n/300),"green")}me(M,12);for(let e=h.x-n;e<h.x+n;e++)for(let i=h.y-n;i<h.y+n;i++)if(lt({x:e,y:i})){let n=st(e,i),h=n.name,a=qt(M,t);Gt(M,h,r(n.q.x)-a/2,o(n.q.y)+5)}At(M,t+150,e+150,2+3*Math.abs(q%200-100)/100,"yellow"),Qt(M)}(),ce(M,"green"),ue(M,"black"),Bt(M,25,25,400,300),Et(M,25,25,400,300),Ht(M,150,175,(()=>{M.lineWidth=.03,ge(M,0,0,40,Y.g,Y.M,{fill:"black",stroke:"green"})})),function(){let t=50,e=275;ce(M,"green"),M.lineWidth=1,M.textBaseline="top",me(M,18),M.fontWeight=800,Ze().forEach((n=>{ue(M,"green"),Gt(M,$e[n].name,e,t),Bt(M,e,t+20,100,10),ue(M,bt(Y.g[n])),Et(M,e,t+20,100*Y.g[n].G/Y.g[n].J,10),t+=55})),ue(M,bt(Y.g.V)),Bt(M,50,35,200,12),Et(M,50,35,200*Y.g.V.G/Y.g.V.J,12),ue(M,"rgba(200,200,50,"+(.5-.5*Y.P/Y.H+.5)+")"),Bt(M,e,t-135,100,4),Et(M,e,t-135,100-100*Y.P/Y.H,4)}()};function gt(){return i(1e3*yt(0,0,Y.p.x,Y.p.y))/10}function bt(t){return t.I?"grey":t.Dt?(t.Dt--,"red"):Pe([128-128*t.G/t.J,0+128*t.G/t.J,0],1)}function xt(t,e){try{return yt(t.x,t.y,e.x,e.y)}catch(t){}}function yt(t,e,n,h){return Math.sqrt(Math.pow(n-t,2)+Math.pow(h-e,2))}function St(t,e){return vt(t.x,t.y,e.x,e.y)}function vt(t,e,n,h){return Math.atan2(h-e,n-t)}function Dt(t,e){return Math.abs((t+n)%n-(e+n)%n)}function Pt(t,e,h){return(t%=n)<0&&(t+=n),(e%=n)<0&&(e+=n),Math.abs(e-t)>h?function(t,e){let h=t-e;h<0&&(h+=n);return h>Math.PI?1:-1}(t,e)>0?1:-1:0}function kt(t,e){return t.x==e.x&&t.y==e.y}function Ct(t,e,n){return Math.min(n,Math.max(e,t))}function Wt(t,e){return{angle:vt(0,0,t,e),Mt:yt(0,0,t,e)}}function Ht(t,e,n,h){Kt(t),Zt(t,e,n),h(),Qt(t)}var At=(t,e,n,h,i)=>{jt(t,e,n,h),ue(t,i),$t(t)},Ot=(t,e,n,h,i)=>{jt(t,e,n,h),ce(t,i),Vt(t)},Rt=(t,e,n,h)=>{Ft(t),e.forEach((e=>{zt(t,e[0],e[1]),Nt(t,e[0],e[1],e[2])})),Lt(t),h&&(ce(t,h),Vt(t)),n&&(ue(t,n),$t(t))},jt=(t,e,n,h)=>{Ft(t),Nt(t,e,n,h,0,8),Lt(t)},Tt=(t,e,n,h)=>{h&&ce(t,"white"),Ft(t),zt(t,e.x,e.y),Yt(t,n.x,n.y),Vt(t),Lt(t)},Yt=(t,e,n)=>t.lineTo(e,n),zt=(t,e,n)=>t.moveTo(e,n),It=(t,e,n,h,i)=>t.quadraticCurveTo(e,n,h,i),Nt=(t,e,h,i)=>t.arc(e,h,i,0,n),Ft=t=>t.beginPath(),Lt=t=>t.closePath(),Vt=t=>t.stroke(),Bt=(t,e,n,h,i)=>t.strokeRect(e,n,h,i),Et=(t,e,n,h,i)=>t.fillRect(e,n,h,i),Gt=(t,e,n,h)=>t.fillText(e,n,h),qt=(t,e)=>t.measureText(e).width,Jt=t=>t.clip(),Kt=t=>t.save(),Qt=t=>t.restore(),Ut=(t,e,n,h,i)=>t.rect(e,n,h,i),Xt=(t,e)=>t.scale(e,e),Zt=(t,e,n)=>t.translate(e,n),$t=t=>t.fill(),_t=t=>{let e=document.createElement("div");return e.className=t,e},te=()=>{let t=_t("dialog");return r(document.body,t),t},ee=t=>{let e=_t("title");return e.innerHTML=t,e},ne=t=>{let e=_t("subTitle");return e.innerHTML=t,e},he=(t,e)=>{let n=document.createElement("button");return n.onclick=e,n.innerHTML=t,n},ie=(t,e)=>{let n=document.createElement("canvas");return n.width=t,n.height=e,n},ae=(t,e,n)=>{t.scale(e,e),t.rotate(n)},re=(t=0,e=1,n=h)=>t+(e-t)*n(),oe=(t,e)=>{e.forEach((e=>r(t,e)))},le=(t,e)=>({x:t,y:e}),se=t=>({x:t.x,y:t.y}),ue=(t,e)=>{t.fillStyle=e},ce=(t,e)=>{t.strokeStyle=e},fe=(t,e,n)=>{t.x=e,t.y=n},Me=(t,e)=>(t.x+=e.x,t.y+=e.y,t),de=(t,e)=>(t.x*=e,t.y*=e,t),we=(t,e,n)=>(t.x+=Math.cos(e)*n,t.y+=Math.sin(e)*n,t),pe=(t,e,n)=>({x:t.x+Math.cos(e)*n,y:t.y+Math.sin(e)*n}),me=(t,e)=>{t.font=e+"px Gill Sans MT"},ge=(t,n,h,i,a,r,o)=>{Ht(t,n,h,(()=>{ae(t,i,r+e),a.W.I&&o.xt||ve(t,a,o),a.B.I&&o.xt||Se(a,t,o),a.V.I&&o.xt||ye(a,t,o),a.m.I&&o.xt||xe(a,t,o)}))};function be(t,e,n,h){n.forEach((n=>{h.fill&&(ue(t,h.fill),t.fill(n)),h.stroke&&(ce(t,h.stroke),t.stroke(n)),h.stroke||h.fill||De(t,n,Pe(n.color||e.color),ke(n.color||e.color,15),h.yt,h.Mt)}))}var xe=(t,e,n)=>{be(e,t.m,[t.m.path,t.m.Ht],n);let h=t.m,i=h.At/(h.C+1);for(let t=1;t<=h.C;t++)if(n.K){let n=h.top+h.Ot+h.ft;var a=-h.At/2+t*i-h.ct/2;ue(e,"rgba(255,55,55,0.8)"),Et(e,a,n,h.ct,re(.1,.25)),ue(e,"rgba(255,255,55,0.8)"),Et(e,a,n,h.ct,re(.1,.25))}},ye=(t,e,n)=>{if(be(e,t.V,[t.V.path],n),!n.fill&&!n.stroke){Kt(e),e.clip(t.V.vt),ue(e,n.fill||"rgba(0,0,0,0.7)"),e.fill(t.V.path),Qt(e);let h=t.V.Rt/2*t.V.jt,i=e.createLinearGradient(-h,0,h,0);i.addColorStop(0,"rgba(50,250,250,1)"),i.addColorStop(1,"rgba(50,150,150,1)");let a="rgba(255,255,255,0.7)";Kt(e),e.scale(t.V.jt,t.V.jt),De(e,t.V.path,i,a,n.yt,n.Mt),Qt(e)}},Se=(t,e,n)=>{if(be(e,t.B,t.B.list.map((t=>t.path)),n),n.F||n.N){let h=0,i=t.B.Tt,a=()=>{Et(e,h,i,.1,re(.2,.35))},r=()=>{ue(e,"rgba(255,55,55,0.8)"),a(),ue(e,"rgba(255,255,55,0.8)"),a()};n.F&&(h=t.B.Yt/2*.8-.1,r()),n.N&&(h=-t.B.Yt/2*.8,r())}},ve=(t,e,n)=>{be(t,e.W,[e.W.path],n)};function De(t,e,n,h,i,a){Kt(t),ue(t,h),t.fill(e),t.clip(e),ue(t,n),Ht(t,Math.cos(i)*a,Math.sin(i)*a,(()=>t.fill(e))),Qt(t)}function Pe(t,e=1){return function(t,e,n,h){return"rgba("+t+","+e+","+n+","+h+")"}(t[0],t[1],t[2],e)}function ke(t,e,n=1){return Pe(t.map((t=>Math.min(255,t+i(e)))),n)}function Ce(t,e){let n=Ne(t);return We(n,e)}var We=(t,e)=>{let n=function(t){return[i(55+50*t()),i(55+50*t()),i(55+50*t())]}(t),h=function(t){let e=i(155*t());return[e,e,e]}(t),a=Math.ceil(2+t()*(e+.01)*1e3),r=function(t,e,n){var h=re(.5,1.5,t),i=re(.5,2.5,t);let a={Rt:h,zt:re(.5,2,t),It:i,Nt:t()*i,Ft:h/2*t(),jt:re(.2,.5,t)};return a.path=je(a),a.G=3*n,a.J=3*n,a.vt=new Path2D,a.color=e,a}(t,n,a),o=function(t,e,n,h,i){let a=t.zt,r=t.It,o=-t.It/2,l=-t.It/2,s=Math.ceil(4*e()),u=[];for(let i=0;i<s;i++){let i=3*e()+Math.min(t.zt,t.Rt),s=4*e()+Math.min(t.zt,t.Rt),f=e()*t.It/2,M=t.It*(.3*e()),d=M+(t.It-M)*(.2*e()+.1),w=d+(t.It-d)*e()*.8,p=w+(t.It-w)*e(),m=e()<.5;var c=e()<.3?n:h;u.push({Rt:i,zt:s,Lt:M,Ot:d,ft:w,Vt:p,offsetTop:f,vt:new Path2D,color:c,Bt:m,path:Ie(i,s,M,d,w,p,-t.It/2,m)}),u[u.length-1].path.color=c,l>f-t.It&&(l=f-t.It),o<f+p-t.It&&(o=f+p-t.It,a=s,r=p)}let f=new Path2D;return u.forEach((t=>f.addPath(t.path))),{Yt:a,Tt:o,Et:l,Gt:r,C:s,list:u,path:f,color:n,vt:new Path2D,G:i,J:i}}(r,t,n,h,a),l=function(t,e,n,h){let i=Math.ceil(5*t()),a=e.zt,r=2*t()*e.zt,o=2.5*t()*r/(i+2),l=e.It/2,s=Math.ceil(1e3*t()*2)/1e3,u=(.5+.5*t())*s,c=s-u,f=r/(i+1),M=[];for(let t=1;t<=i;t++)M.push([-r/2+t*f-o/2,l+u]);return{It:s,Ot:u,ft:c,qt:a,At:r,ct:o,top:l,C:i,Jt:f,color:n,points:M,path:Te(l,a,u,r),Ht:Ye(M,o,c),vt:new Path2D,G:h,J:h}}(t,r,n,a),s=function(t,e,n,h){let i=Math.ceil(3*t()),a=[re(100,255,t),re(100,255,t),re(100,255,t)],r=.1+.15*t(),o=Math.max.apply(null,e.list.map((t=>t.zt))),l=Math.min.apply(null,e.list.map((t=>t.zt))),s=0-o/2+t()*(o/2-i*r),u=Math.max((0-s-i*r)/(i+1),0),c=1.2*e.Gt*t(),f=e.Tt-e.Gt,M=(.3+.5*t())*r,d=r,w=c*t(),p=c-w,m=M/2,g=d/2,b=[[-m,0],[-m,w],[-g,w],[-g,w+p],[g,w+p],[g,w],[m,w],[m,0]],x=new Path2D;x.rect(s,f,(r+u)*i*2+2*u,c);let y=t()<.5,S=He(i,b,s,u,r,f,y);return{Kt:M,Qt:d,Ot:w,ft:p,w:r,It:c,x:s,top:f,margin:u,C:i,Ut:o,Xt:l,color:n,dt:a,Bt:y,G:h,J:h,vt:new Path2D,path:S,St:x}}(t,o,h,a);return{V:r,B:o,m:l,W:s}};function He(t,e,n,h,i,a,r){let o=new Path2D;for(let l=0;l<t;l++)o.addPath(ze(e.map((t=>[t[0]+n+l*(h+i),t[1]+a])),r)),o.addPath(ze(e.map((t=>[t[0]-n-l*(h+i),t[1]+a])),r));return o}function Ae(t,e,n){return t*n+e*(1-n)}function Oe(t,e,n,h){let i={};return n.forEach((n=>{i[n]=Ae(t[n],e[n],h)})),i.color=Re(t.color,e.color,h),i.vt=new Path2D,i.G=i.J,i}function Re(t,e,n){return[t[0]*n+(1-n)*e[0],t[1]*n+(1-n)*e[1],t[2]*n+(1-n)*e[2]]}function je(t){let e=new Path2D;zt(e,-t.Rt/2,-t.It/2);let n=t.Rt/2,h=t.It/2;return e.bezierCurveTo(-n+t.Ft,-h-t.Nt,n-t.Ft,-h-t.Nt,n,-h),Yt(e,t.zt/2,h),Yt(e,-t.zt/2,h),Yt(e,-t.Rt/2,-h),e}function Te(t,e,n,h){let i=new Path2D;return zt(i,-e/2,t),Yt(i,e/2,t),Yt(i,h/2,t+n),Yt(i,-h/2,t+n),Yt(i,-e/2,t),i}function Ye(t,e,n){let h=new Path2D;return t.forEach((t=>{h.rect(t[0],t[1],e,n)})),h}function ze(t,e){let n=new Path2D;if(e){zt(n,t[0][0],t[0][1]);let e=1;for(e=1;e<t.length-2;e++){let h=(t[e][0]+t[e+1][0])/2,i=(t[e][1]+t[e+1][1])/2;It(n,t[e][0],t[e][1],h,i)}It(n,t[e][0],t[e][1],t[e+1][0],t[e+1][1])}else{zt(n,t[0][0],t[0][1]);for(let e=1;e<t.length;e++)Yt(n,t[e][0],t[e][1])}return Yt(n,t[0][0],t[0][1]),n}function Ie(t,e,n,h,i,a,r,o){let l=new Path2D,s=[[0,r+n],[-t/2,r+h],[-e/2,r+i],[0,r+a],[e/2,r+i],[t/2,r+h],[0,r+n]];if(o){zt(l,s[0][0],s[0][1]);let t=1;for(t=1;t<s.length-2;t++){let e=(s[t][0]+s[t+1][0])/2,n=(s[t][1]+s[t+1][1])/2;It(l,s[t][0],s[t][1],e,n)}It(l,s[t][0],s[t][1],s[t+1][0],s[t+1][1])}else{zt(l,s[0][0],s[0][1]);for(let t=1;t<s.length;t++)Yt(l,s[t][0],s[t][1])}return l}var Ne=t=>{return e=t,function(){var t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296};var e},Fe=(t,e)=>{let n=document.getElementById("b");n.style.margin=0,document.body.margin=0,n.width=t,n.height=e;let i=n.getContext("2d");for(let n=0;n<1e3;n++)ue(i,Pe([125,155+100*h(),155+100*h()],.4)),Be(i,h()*t,h()*e,2*h())},Le=1,Ve=(t,e,i,a,r)=>{Le+=.1;for(let o=0;o<3;o++)ue(e,ke(r,re(0,50),re(0,1-t))),Ft(e),e.ellipse(i.x,i.y,a*t*h(),a*t*h(),.01*Le%1.248*n,0,n,0),$t(e),Lt(e)},Be=(t,e,i,a)=>{let r=h()*n;t.lineWidth=.5*a,Ft(t),Ee(t,e,i,a,r),Ee(t,e,i,a,r+Math.PI),$t(t),Lt(t)},Ee=(t,e,h,i,a)=>{let r=n/3;zt(t,e+Math.cos(a)*i,h+Math.sin(a)*i),Yt(t,e+Math.cos(a+r)*i,h+Math.sin(a+r)*i),Yt(t,e+Math.cos(a+2*r)*i,h+Math.sin(a+2*r)*i)},Ge="AEIOUY",qe="BCDFGHJKLMNPQRSTVWXY",Je=t=>{let e="";for(let n=Math.round(t());n<3+3*t();n++){let h=(n+1)%2?Ge[i(t()*(Ge.length-.1))]:qe[i(t()*(qe.length-.1))];e+=0==e.length?h:h.toLowerCase()}return e+=["ian","ord","an","ar","'ok"][i(4.9*t())],e};var Ke=t=>{let e="";for(let n=Math.round(t());n<5+3*t();n++)e+=n%2?Ge[i(t()*(Ge.length-.1))]:qe[i(t()*(qe.length-.1))];var n;return e+=t()>.5?" "+((n=t())<.2?"IV.":n<.4?"V.":n<.6?"III.":n<.8?"II.":""):"",e},Qe=(t,n,h)=>{let i=Math.min(150,Math.max(30,window.innerWidth/8)),l=te(),s=_t("cont");r(l,ee("Assimilation")),r(l,ne("You destroyed all of the "+n.race+"s. Now steal their tech.")),r(l,s),r(l,ne("Click Ship parts on the right to assimilate"));let u=_t("col"),c=_t("col"),f=_t("colWide"),M=_t("col"),d=_t("col"),w=ie(i,2*i),p=w.getContext("2d"),m=ie(i,2*i),g=m.getContext("2d");r(u,w),r(M,m);let b=!1,x={V:t.g.V,B:t.g.B,W:t.g.W,m:t.g.m};var y=t=>{p.clearRect(0,0,i,2*i),g.clearRect(0,0,i,2*i);let h={yt:-e,Mt:.1,K:!0,F:!0,N:!0};ge(p,i/2,i,i/5,t,-e,h),ge(g,i/2,i,i/5,n.g,-e,h),b||window.requestAnimationFrame((()=>y(t)))};y(x);let S=$e;Object.values(S).forEach((t=>{t.Zt={},t.$t={},t._t={}})),Object.keys(S).forEach((e=>{let h=_t("comp"),a=ie(i,i),l=a.getContext("2d");l.translate(i/2,i/2),l.scale(i/5,i/5),S[e].o(l,x),r(h,a);let s=_t("compWide"),u=_t("statCol"),M=_t("statCol"),w=_t("statCol"),p=_t("statCol"),m=_t("statCol");oe(s,[u,M,w,p,m]),Object.entries(S[e].te).forEach((h=>{let i=h[0],a=h[1](t),o=_t("statValue"),l=_t("statValueChange"),s=_t("statValue2"),c=_t("statName");c.innerHTML=i,S[e].Zt[i]=o,S[e]._t[i]=l,l.innerHTML="(+0)",S[e].$t[i]=a,o.innerHTML=Ue(S[e],i,a),s.innerHTML=Ue(S[e],i,h[1](n)),r(u,o),r(M,l),r(w,c),r(m,s)}));let g=_t("comp clickable"),b=ie(i,i),y=b.getContext("2d");y.translate(i/2,i/2),y.scale(i/5,i/5),S[e].o(y,n.g),r(g,b),o(b,"click",(()=>{!function(t,e,n,h,i,a,r){let o,l,s,u,c=50,f=n[h],M=(t,i)=>{null!=t&&null!=i&&(!0,c--,r[h]=f.ee(r,t,i,Math.max(.5,c/50)),"hull"!=h&&"thrust"!=h||(r.m.top=r.V.It/2,r.m.qt=r.V.zt,r.m=n.m.ee(r,r,r,.5)),clearRect(e,-150,-150,300,300),Kt(e),e.shadowBlur="15px",e.shadowColor="red",f.o(e,r),Qt(e),c>0?window.requestAnimationFrame((()=>{M(t,i)})):!1)};t.classList.contains("selected")?(t.classList.remove("selected"),f.selected=!1,s=t=>f.te[t](i),u=()=>0,o=r,l=i.g):(c=50,t.classList.add("selected"),f.selected=!0,s=t=>(f.te[t](i)+f.te[t](a))/2,u=t=>{let e=f.te[t];e(i);let n=f.ne&&f.ne[t]?f.ne[t]:Xe;return n((e(i)+e(a))/2)-n(e(i))},o=i.g,l=a.g);Object.entries(f.te).forEach((t=>{let e=t[0];f.Zt[e].innerHTML=Ue(f,e,s(e));let n=u(e);f._t[e].innerHTML="("+(n>=0?"+":"")+Xe(n)+")",f._t[e].className=n>0?"plus":n<0?"minus":""})),M(o,l)}(g,l,S,e,t,n,x)})),r(c,h),r(f,s),r(d,g)})),oe(s,[u,c,f,d,M]);let v=he("Confirm",(()=>{t.g=x,l.style.height="0%",window.setTimeout((()=>{a(l),b=!0,Object.entries(S).filter((t=>t[1].selected)).forEach((e=>{switch(e[0]){case"wings":t.v=(t.v+n.v)/2;break;case"weapons":t.k=(t.k+n.k)/2,t.H=(t.H+n.H)/2,t.O=(t.O+n.O)/2,t.S=(t.S+n.S)/2,t.D=t.S/t.O;break;case"thrust":t.speed=(t.speed+n.speed)/2}})),h()}),300)}));r(l,v),window.setTimeout((()=>l.style.height="100%"),50)};function Ue(t,e,n){let h=t.ne&&t.ne[e]?t.ne[e]:Xe,i=t.suffixes&&t.suffixes[e]?t.suffixes[e]:"";return h(n,1)+i}function Xe(t,e){return 0==t?t:(e=e||Math.ceil(Math.abs(Math.log10(Math.abs(Math.max(-1,Math.min(1,t))))))+1,i(Math.pow(10,e)*t)/Math.pow(10,e))}var Ze=()=>Object.keys($e).sort(((t,e)=>-("hull"==t?1:0))),$e={W:{name:"Weapons",te:{he:t=>t.g.W.J,ie:t=>t.H,ae:t=>t.k,re:t=>t.O,Range:t=>t.D*t.O},ne:{ie:t=>Xe(60/t,3),re:t=>Xe(100*t,1)},suffixes:{ie:"/s",re:"km/s"},o:(t,e)=>{Ht(t,0,1,(()=>ve(t,e,.5,.5)))},ee:(t,e,n,h)=>((t,e,n)=>{let h=Oe(t,e,["w","x","top","margin","h","topW1","topW2","h1","h2","maxHp"],n),i=h.Kt/2,a=h.Qt/2,r=[[-i,0],[-i,h.Ot],[-a,h.Ot],[-a,h.Ot+h.ft],[a,h.Ot+h.ft],[a,h.Ot],[i,h.Ot],[i,0]];return h.C=e.C,h.St=new Path2D,h.St.rect(h.x,h.top,(h.w+h.margin)*h.C*2+2*h.margin,h.It),h.Bt=t.Bt^e.Bt,h.path=He(h.C,r,h.x,h.margin,h.w,h.top,h.Bt),h.Ut=Math.min(t.Ut,e.Ut),h.Xt=Math.max(t.Xt,e.Xt),h.dt=Re(t.dt,e.dt,n),h})(e.W,n.W,h)},V:{name:"Hull",te:{he:t=>t.g.V.J},o:(t,e)=>ye(e,t,.5,.5),ee:(t,e,n,h)=>function(t,e,n){let h=Oe(t,e,["topW","bottomW","h","controlTop","controlSide","windowSize","maxHp"],n);return h.path=je(h),h}(e.V,n.V,h)},B:{name:"Wings",ne:{oe:t=>Xe(100*t,3)},te:{he:t=>t.g.B.J,oe:t=>t.v},o:(t,e)=>Se(e,t,.5,.5),ee:(t,e,n,h)=>function(t,e,n,h){let i=[];for(let a=0;a<n.list.length;a++)if(e.list[a]&&n.list[a]){let r=e.list[a],o=n.list[a],l=Oe(r,o,["topW","bottomW","h0","h1","h2","h3"],h);l.offsetTop=Ae(r.offsetTop,o.offsetTop,h),l.path=Ie(l.Rt,l.zt,l.Lt,l.Ot,l.ft,l.Vt,-t/2,r.Bt^o.Bt),i.push(l)}else i.push(n.list[a]);let a=new Path2D;i.forEach((t=>a.addPath(t.path)));let r=Oe(e,n,["maxW","maxY","minY","maxH","maxHp"],h);return r.C=n.C,r.list=i,r.path=a,r}(t.V.It,e.B,n.B,h)},m:{name:"Thrust",ne:{le:t=>Xe(1e3*t,3)},te:{he:t=>t.g.B.J,le:t=>t.speed},o:(t,e)=>Ht(t,0,-5/4,(()=>xe(e,t,.5,.5,!0))),ee:(t,e,n,h)=>((t,e,n,h)=>{let i=Oe(e,n,["h","w1","w2","h1","h2","tw","maxHp"],h);i.C=n.C,i.top=Ae(e.top,t.It/2,h),i.Jt=i.At/(i.C+1),i.points=[];for(let t=1;t<=i.C;t++)i.points.push([-i.At/2+t*i.Jt-i.ct/2,i.top+i.Ot]);return i.path=Te(i.top,i.qt,i.Ot,i.At),i.Ht=Ye(i.points,i.ct,i.ft),i})(t.V,e.m,n.m,h)}};let _e=["ACE","GBD","FAC","GBD"];var tn,en={se:440,ue:523.3,E:659.3,ce:392,fe:439.9,Me:587.3,de:349.2},nn=[.25,.5,1,2,4];class hn{constructor(){this.we=new AudioContext,this.pe(),this.me=0,this.ge=0,this.be=0,this.xe=0,this.ye=1.5,this.Se=[2,.25,.25,.5],this.ve=.8,this.De={}}Pe(){let t=nn[i(h()*nn.length)],e=_e[this.me].split("")[i(3*h())];this.ke(this.we,e,re(.1,.05),this.time,this.be-this.time,t*this.ve,"triangle"),this.be+=t}pe(){if(this.time=this.we.currentTime,this.ge-this.time<1){this.me++,this.me=this.me%_e.length;let t=0;this.Se.forEach(((e,n)=>{this.Ce(this.we,_e[this.me].split(""),this.ge-this.time+t,e*this.ve),t+=e})),this.ge+=t}this.be-this.time<1&&this.Pe(),window.requestAnimationFrame(this.pe.bind(this))}Ce(t,e,n,h){let i=.05/e.length,a=t.currentTime;e.forEach((e=>{this.ke(t,e,i,a,n,h)}))}ke(t,e,n,h,i,a,r){var o=t.createOscillator(),l=t.createGain();l.gain.value=0,l.gain.setValueAtTime(0,h+i),l.gain.linearRampToValueAtTime(n,h+i+.25),l.gain.setValueAtTime(n,h+i+a),l.gain.exponentialRampToValueAtTime(1e-5,h+i+a+1),o.type=r||"sine",o.connect(l),o.frequency.value=en[e],o.start(h+i),o.stop(h+i+a+2),l.connect(t.destination),window.setTimeout((()=>{l.disconnect(),o.disconnect()}),1e3*(i+a+2))}rt(t){let e=this.we,n=e.currentTime,h=e.createOscillator();h.frequency.value=t.We,h.type=t.type||"sine";let i=e.createGain();i.gain.value=0,i.gain.setValueAtTime(0,n),t.He.forEach((e=>{i.gain.linearRampToValueAtTime(e[1],n+t.Ae*e[0])})),h.connect(i),h.start(n),h.stop(n+t.Ae),i.connect(e.destination),window.setTimeout((()=>{i.disconnect(),h.disconnect()}),1e3*(t.Ae+2))}}var an={He:[[.1,.03],[.1,.08],[1,0]],We:140,Ae:.1},rn={He:[[.1,.1],[.2,.5],[.3,.1],[.5,.5],[1,0]],We:30,Ae:.5,type:"sine"}}();